# Quality Gate: Story 6.15 - Bidirectional Task-Law List Item Linking
# Generated by Quinn (Test Architect)

schema: 1
story: '6.15'
story_title: 'Bidirectional Task-Law List Item Linking'
gate: CONCERNS
status_reason: 'Implementation meets functional requirements but lacks unit test coverage for the new TasksAccordion component, creating maintainability risk.'
reviewer: 'Quinn (Test Architect)'
updated: '2026-01-28T00:00:00Z'

waiver: { active: false }

top_issues:
  - id: 'TEST-001'
    severity: medium
    finding: 'New TasksAccordion component (831 lines) has no unit test coverage'
    suggested_action: 'Create tasks-accordion.test.tsx with tests for navigation, unlink, link dialog, and collapsible sections'
    suggested_owner: dev
  - id: 'IMPL-001'
    severity: low
    finding: 'Unlink operation lacks optimistic update pattern per AC #12'
    suggested_action: 'Add optimistic removal with rollback on error (pattern exists in linked-laws-box.tsx)'
    suggested_owner: dev
  - id: 'TEST-002'
    severity: low
    finding: 'Existing tasks-summary-box.test.tsx tests deprecated component'
    suggested_action: 'Update tests to cover TasksAccordion or mark as deprecated'
    suggested_owner: dev

quality_score: 70  # 100 - (0 FAILs * 20) - (1 medium * 10) - (2 low * 10) = 70

evidence:
  tests_reviewed: 1  # tasks-summary-box.test.tsx (deprecated component)
  risks_identified: 0
  trace:
    ac_covered: [1, 2, 3, 5, 6, 7, 8, 9, 10, 11, 13, 14]
    ac_gaps: [4, 12]  # AC #4 changed to collapsible sections, AC #12 missing optimistic updates

nfr_validation:
  security:
    status: PASS
    notes: 'Uses existing authenticated server actions with workspace isolation'
  performance:
    status: PASS
    notes: 'SWR caching, debounced search, lazy loading - all patterns followed'
  reliability:
    status: PASS
    notes: 'Error handling with toast feedback, graceful degradation'
  maintainability:
    status: CONCERNS
    notes: 'New 831-line component lacks test coverage'

recommendations:
  immediate:
    - action: 'Add unit tests for TasksAccordion component'
      refs: ['components/features/document-list/legal-document-modal/tasks-accordion.tsx']
  future:
    - action: 'Add optimistic updates to unlink operation'
      refs: ['tasks-accordion.tsx:186-202']
    - action: 'Clean up deprecated tasks-summary-box tests'
      refs: ['tests/unit/components/features/document-list/legal-document-modal/tasks-summary-box.test.tsx']

# AC Deviation Notes:
# - AC #4: "Visa alla (N)" button was replaced with collapsible Pågående/Avslutade sections
#   This is a documented UX decision that improves usability (see Dev Notes)
# - AC #12: Optimistic updates not fully implemented for unlink operation
#   Function works correctly but refetches instead of optimistically removing
