# Story 3.3: Build AI Chat UI with Streaming Responses

## Status

Draft

## Story

**As a** user,
**I want** to type a legal question and see the AI response stream in real-time,
**so that** I get fast, engaging answers.

## Acceptance Criteria

1. AI Chat sidebar component created (fixed right side, 400px width)
2. Chat interface: message history, input field, send button
3. User types question, clicks Send
4. Message appears in chat history immediately
5. AI response streams word-by-word using Vercel AI SDK `useChat` hook
6. Streaming animation (typing indicator while waiting)
7. Citations appear inline: `[1]`, `[2]` with hover tooltips showing source law
8. Citation tooltip: law title, SFS number, snippet, "View law" link
9. Chat history persisted in workspace
10. Mobile: Chat sidebar converts to full-screen modal
11. Keyboard shortcut: `Cmd+K` or `/` opens chat

## Tasks / Subtasks

- [ ] Create chat sidebar component (AC: 1, 2)
- [ ] Implement message sending (AC: 3, 4)
- [ ] Add streaming with Vercel AI SDK (AC: 5, 6)
- [ ] Implement citation UI (AC: 7, 8)
- [ ] Persist chat history (AC: 9)
- [ ] Mobile responsive design (AC: 10)
- [ ] Add keyboard shortcuts (AC: 11)

## Dev Notes

**Component:** `components/features/chat/chat-sidebar.tsx`

**Streaming with Vercel AI SDK:**

```typescript
import { useChat } from 'ai/react'

export function ChatSidebar() {
  const { messages, input, handleInputChange, handleSubmit, isLoading } = useChat({
    api: '/api/chat/query',
  })

  return (
    <div className="fixed right-0 top-0 h-screen w-[400px] border-l bg-white">
      {/* Message history */}
      <div className="flex-1 overflow-y-auto p-4">
        {messages.map(m => (
          <div key={m.id}>
            {m.role === 'user' ? <UserMessage>{m.content}</UserMessage> : <AIMessage>{m.content}</AIMessage>}
          </div>
        ))}
      </div>

      {/* Input */}
      <form onSubmit={handleSubmit} className="border-t p-4">
        <input
          value={input}
          onChange={handleInputChange}
          placeholder="Ask about Swedish law..."
          className="w-full"
        />
      </form>
    </div>
  )
}
```

**Reference:** Architecture Section 6 (Components), Front-End Spec (Chat Interface)

## Change Log

| Date       | Version | Description            | Author     |
| ---------- | ------- | ---------------------- | ---------- |
| 2025-11-11 | 1.0     | Initial story creation | Sarah (PO) |

## Dev Agent Record

_To be populated by dev agent_

## QA Results

_To be populated by QA agent_
