# Story 12.10b: Refactor Create List Modal into Template-Aware Chooser

## Status

Draft

## Story

**As a** workspace member,
**I want** the "Skapa ny lista" flow to surface available templates alongside the blank-list option,
**so that** I can discover and adopt expert-curated templates without leaving my workspace context.

## Background

The current "Skapa ny lista" flow (Story 4.11) opens a plain modal with name, description, and default-list toggle. Once templates exist, this is a missed opportunity â€” users in their workspace should be able to discover and adopt templates at the moment they're creating a new list, not only via the public catalog.

This story refactors the create-list modal into a two-path creation flow that is more engaging and surfaces templates as the recommended starting point.

## Acceptance Criteria

1. When user clicks "Skapa ny lista" (from the document list switcher dropdown), the modal opens with a **chooser view** instead of the current plain form:
   - Two prominent option cards: "BÃ¶rja frÃ¥n mall" and "Tom lista"
   - If published templates exist, show a "PopulÃ¤ra mallar" section with template preview cards inline (max 3-4)
2. **"BÃ¶rja frÃ¥n mall" path**:
   - Selecting a template card shows a quick preview: template name, description, document count, section count, regulatory bodies
   - "AnvÃ¤nd denna mall" button triggers the adoption flow (Story 12.10 server action)
   - Name is pre-filled from template name (editable), description pre-filled from template description
   - Default-list toggle available
   - On success: list created with template items, same toast and redirect as 12.10
3. **"Tom lista" path**:
   - Shows the current create form (name, description, default toggle) â€” identical to today's behavior
   - No regression in the blank-list creation flow
4. **Template card in chooser**:
   - Shows: template name, domain badge, document count, brief description excerpt
   - TjÃ¤nstefÃ¶retag variants shown as a subtle toggle or secondary option on the parent card
5. **Empty state**: If no published templates exist, skip the chooser and show the current plain form directly (no UX regression)
6. **Edit mode unchanged**: When `mode='edit'`, the modal behaves exactly as today â€” no chooser, just the edit form
7. Responsive: works on mobile (cards stack vertically)

## UX Wireframe

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Skapa ny laglista                              [Ã—]  â”‚
â”‚  VÃ¤lj hur du vill bÃ¶rja.                             â”‚
â”‚                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ğŸ“‹ BÃ¶rja frÃ¥n mall  â”‚  â”‚  âœ¨ Tom lista        â”‚  â”‚
â”‚  â”‚                      â”‚  â”‚                      â”‚  â”‚
â”‚  â”‚  VÃ¤lj bland expert-  â”‚  â”‚  Skapa en helt egen  â”‚  â”‚
â”‚  â”‚  framtagna laglistor â”‚  â”‚  laglista frÃ¥n       â”‚  â”‚
â”‚  â”‚  med fÃ¤rdiga lagar   â”‚  â”‚  grunden             â”‚  â”‚
â”‚  â”‚  och sammanfattningarâ”‚  â”‚                      â”‚  â”‚
â”‚  â”‚         [VÃ¤lj]       â”‚  â”‚        [VÃ¤lj]        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                      â”‚
â”‚  â”€â”€ PopulÃ¤ra mallar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ArbetsmiljÃ¶â”‚ â”‚MiljÃ¶     â”‚ â”‚Arb.tj.   â”‚             â”‚
â”‚  â”‚112 lagar â”‚ â”‚98 lagar  â”‚ â”‚55 lagar  â”‚             â”‚
â”‚  â”‚Alla arb. â”‚ â”‚Tillverk. â”‚ â”‚TjÃ¤nstef. â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

After selecting a template:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â† Tillbaka    Skapa frÃ¥n mall                  [Ã—]  â”‚
â”‚                                                      â”‚
â”‚  Mall: ArbetsmiljÃ¶                                   â”‚
â”‚  112 lagar Â· ArbetsmiljÃ¶verket, Riksdagen, EU        â”‚
â”‚  "Komplett laglista fÃ¶r alla svenska arbetsgivare..." â”‚
â”‚                                                      â”‚
â”‚  â”€â”€ Anpassa â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚  Namn                                                â”‚
â”‚  [ArbetsmiljÃ¶                                    ]   â”‚
â”‚                                                      â”‚
â”‚  Beskrivning (valfritt)                              â”‚
â”‚  [Komplett laglista...                           ]   â”‚
â”‚                                                      â”‚
â”‚  Standardlista                              [  o  ]  â”‚
â”‚                                                      â”‚
â”‚               [Avbryt]  [Skapa frÃ¥n mall]            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Tasks / Subtasks

- [ ] **Task 1: Create chooser step component** (AC: 1, 5)
  - [ ] Create `components/features/document-list/create-list-chooser.tsx`
  - [ ] Two option cards: "BÃ¶rja frÃ¥n mall" and "Tom lista"
  - [ ] Fetch published templates via query (reuse from 12.8 `lib/db/queries/template.ts`)
  - [ ] If no published templates â†’ skip chooser, render current form directly
  - [ ] "PopulÃ¤ra mallar" section with inline template preview cards (max 3-4)
- [ ] **Task 2: Create template preview step** (AC: 2)
  - [ ] Create `components/features/document-list/create-list-from-template.tsx`
  - [ ] Shows selected template summary (name, description, doc count, regulatory bodies)
  - [ ] Pre-fills name and description (editable)
  - [ ] Default-list toggle
  - [ ] "Tillbaka" link returns to chooser
  - [ ] "Skapa frÃ¥n mall" button calls `adoptTemplate()` server action (from Story 12.10)
  - [ ] Loading state during adoption, toast on success
- [ ] **Task 3: Create inline template card component** (AC: 4)
  - [ ] Create `components/features/document-list/template-option-card.tsx`
  - [ ] Compact card: template name, domain badge, doc count, description excerpt
  - [ ] Clickable â†’ selects template and advances to preview step
  - [ ] Variant toggle for tjÃ¤nstefÃ¶retag if applicable
- [ ] **Task 4: Refactor ManageListModal to support multi-step** (AC: 1, 3, 6)
  - [ ] Modify `components/features/document-list/manage-list-modal.tsx`
  - [ ] When `mode='create'`: render chooser step first (or plain form if no templates)
  - [ ] Internal state: `step: 'choose' | 'from-template' | 'blank'`
  - [ ] When `mode='edit'`: render current edit form unchanged (no regression)
  - [ ] Widen modal for chooser step: `sm:max-w-lg` or `sm:max-w-xl` (current is `sm:max-w-md`)
- [ ] **Task 5: Responsive layout** (AC: 7)
  - [ ] Option cards: side-by-side on desktop, stacked on mobile
  - [ ] Template preview cards: horizontal scroll or wrap
  - [ ] Preview step: same form layout as current modal
- [ ] **Task 6: Write tests** (AC: all)
  - [ ] Component test: chooser renders two option cards when templates exist
  - [ ] Component test: chooser skips to plain form when no templates exist
  - [ ] Component test: selecting template navigates to preview step
  - [ ] Component test: "Tom lista" navigates to blank form
  - [ ] Component test: edit mode renders current form (no chooser)
  - [ ] Component test: back button returns to chooser from preview
  - [ ] Integration test: full flow â€” select template â†’ customize name â†’ create â†’ list adopted

## Dev Notes

### Current Implementation (to refactor)

**Entry point:** `components/features/document-list/document-list-switcher.tsx` line 96-99
- "Skapa ny lista" dropdown item calls `onCreateList()` callback
- Parent component opens `ManageListModal` with `mode='create'`

**Current modal:** `components/features/document-list/manage-list-modal.tsx`
- Plain form: name (Input), description (Textarea), default toggle (Switch)
- Calls `createDocumentList()` server action from `app/actions/document-list.ts`
- Width: `sm:max-w-md`

### Multi-step State Machine

```
mode='create':
  has published templates? â”€â”€yesâ”€â”€â–º step='choose'
                           â”€â”€noâ”€â”€â”€â–º step='blank' (current form)

step='choose':
  "BÃ¶rja frÃ¥n mall" clicked â”€â”€â–º step='from-template' (with selected templateId)
  "Tom lista" clicked â”€â”€â”€â”€â”€â”€â”€â”€â–º step='blank'
  Template card clicked â”€â”€â”€â”€â”€â”€â–º step='from-template' (with selected templateId)

step='from-template':
  "Tillbaka" â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º step='choose'
  "Skapa frÃ¥n mall" â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º adoptTemplate() â†’ onCreated()

step='blank':
  "Tillbaka" â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º step='choose' (if templates exist)
  "Skapa" â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º createDocumentList() â†’ onCreated()

mode='edit':
  Always renders current edit form (no state machine)
```

### Adoption Integration

The "Skapa frÃ¥n mall" action reuses the `adoptTemplate()` server action from Story 12.10. The key difference is the entry point:
- Story 12.10: user arrives from public catalog page `/laglistor/{slug}`
- Story 12.10b: user triggers from workspace create-list modal

Both call the same server action. The modal just needs to pass the `workspaceId` (available from workspace context) and `templateId`.

### Dependencies

- **Blocked by:** Story 12.10 (adoption server action must exist)
- **Uses:** Story 12.8 template query (published templates)
- **Modifies:** `manage-list-modal.tsx` (Story 4.11)

### Relevant Source Tree

```
components/features/document-list/manage-list-modal.tsx       # MODIFY â€” add multi-step
components/features/document-list/create-list-chooser.tsx     # NEW â€” chooser step
components/features/document-list/create-list-from-template.tsx # NEW â€” template preview step
components/features/document-list/template-option-card.tsx    # NEW â€” compact template card
components/features/document-list/document-list-switcher.tsx  # NO CHANGE â€” entry point unchanged
lib/db/queries/template.ts                                     # REUSE â€” published template query
app/actions/template-adoption.ts                               # REUSE â€” adoptTemplate() from 12.10
```

### Testing

- **Test framework:** Vitest 1.4+ with React Testing Library
- **Test location:** `tests/unit/components/features/document-list/`
- **Tests needed:**
  - Chooser renders when published templates exist
  - Chooser skips when no published templates (falls back to plain form)
  - Template card click â†’ preview step with correct template data
  - "Tom lista" â†’ blank form
  - Back navigation works from both paths
  - Edit mode: no regression, renders current form
  - Adoption flow: calls adoptTemplate with correct args
  - Pre-filled name from template is editable

## Change Log

| Date       | Version | Description            | Author     |
|------------|---------|------------------------|------------|
| 2026-02-08 | 1.0     | Initial story creation | Sarah (PO) |

## Dev Agent Record

_To be populated by dev agent_

## QA Results

_To be populated by QA agent_
