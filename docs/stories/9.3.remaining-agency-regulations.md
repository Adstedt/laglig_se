# Story 9.3: Remaining Agency Regulation Ingestion

## Status

Draft

## Story

**As a** compliance officer using Laglig.se,
**I want** all remaining agency föreskrifter (ELSÄK-FS, KIFS, BFS, SRVFS, SKVFS, SCB-FS, SSMFS, STAFS) required by the seed templates ingested with full HTML content,
**so that** both the Arbetsmiljö and Miljö templates have complete coverage across all 10 regulatory authorities.

## Acceptance Criteria

### ELSÄK-FS Documents (5 documents — Arbetsmiljö template)

1. ELSÄK-FS 2017:2 (elinstallationsarbete) stored with full content
2. ELSÄK-FS 2017:3 (elinstallationsföretag) stored with full content
3. ELSÄK-FS 2022:1 (utförande av starkströmsanläggningar) stored with full content
4. ELSÄK-FS 2022:2 (skyltning av starkströmsanläggningar) stored with full content
5. ELSÄK-FS 2022:3 (kontroll av starkströmsanläggningar) stored with full content

### KIFS Documents (2 documents — shared)

6. KIFS 2017:7 (kemiska produkter och biotekniska organismer) stored with full content
7. KIFS 2022:3 (bekämpningsmedel) stored with full content

### Single-Authority Documents (7 documents)

8. BFS 2011:16 - OVK (funktionskontroll av ventilationssystem) stored with full content
9. SRVFS 2004:3 (systematiskt brandskyddsarbete) stored with full content
10. SRVFS 2004:7 (explosionsfarlig miljö vid brandfarliga gaser/vätskor) stored with full content
11. SKVFS 2015:6 (personalliggare) stored with full content
12. SCB-FS 2024:25 (statistik om miljöskyddskostnader) stored with full content
13. SSMFS 2018:2 (anmälningspliktiga verksamheter, strålning) stored with full content
14. STAFS 2020:1 (ackreditering) stored with full content

### Data Quality

15. All 14 documents have `html_content`, `full_text`, and `markdown_content` populated
16. HTML uses `.legal-document` CSS structure
17. Existing stub records updated via upsert (no duplicates)
18. All entries have `status = 'ACTIVE'`, valid `source_url`, and `content_type = 'AGENCY_REGULATION'`

## Tasks / Subtasks

- [ ] **Task 1: Locate and download PDFs from 8 authority websites** (AC: 1-14)
  - [ ] ELSÄK-FS: elsakerhetsverket.se/om-oss/foreskrifter/ — 5 PDFs
  - [ ] KIFS: kemi.se — 2 PDFs
  - [ ] BFS: boverket.se — 1 PDF (OVK 1)
  - [ ] SRVFS: msb.se (legacy Räddningsverket) — 2 PDFs
  - [ ] SKVFS: skatteverket.se — 1 PDF
  - [ ] SCB-FS: scb.se — 1 PDF
  - [ ] SSMFS: stralsakerhetsmyndigheten.se — 1 PDF
  - [ ] STAFS: swedac.se — 1 PDF
  - [ ] Store all PDFs in `data/misc-agency-pdfs/` organized by prefix
  - [ ] Record source URLs for metadata

- [ ] **Task 2: Process all 14 documents through ingestion pipeline** (AC: 1-14, 15-18)
  - [ ] Reuse `scripts/ingest-agency-regulations.ts` from Story 9.2
  - [ ] Run with appropriate authority flag or document list
  - [ ] No chapter splitting needed — all are individual regulations
  - [ ] Validate HTML output for each document

- [ ] **Task 3: Handle edge cases** (AC: 15-18)
  - [ ] Legacy SRVFS documents (2004) may have old-format PDFs — verify readability
  - [ ] SCB-FS 2024:25 is a statistics regulation — may have unusual table-heavy format
  - [ ] BFS 2011:16 (OVK) may reference building codes with specific formatting
  - [ ] If any PDF fails Claude processing, flag for manual review

- [ ] **Task 4: Verification** (AC: 15-18)
  - [ ] Query database: all 14 documents have non-null content fields
  - [ ] Verify no duplicate records alongside existing stubs
  - [ ] Spot-check 1 document per authority for HTML quality

## Dev Notes

### Pipeline Reuse

This story reuses the generic ingestion pipeline created in Stories 9.1/9.2. No new prompt engineering or pipeline work needed — just downloading PDFs from different websites and running them through the same process.

### Source Websites

| Authority | Website | Notes |
|-----------|---------|-------|
| Elsäkerhetsverket | elsakerhetsverket.se/om-oss/foreskrifter/ | Well-organized, modern site |
| Kemikalieinspektionen | kemi.se | Search by KIFS number |
| Boverket | boverket.se | Look under "Regler" or BFS series |
| Räddningsverket (MSB) | msb.se | Legacy SRVFS docs may be archived |
| Skatteverket | skatteverket.se | SKVFS under "Lagar och regler" |
| SCB | scb.se | Statistical regulations section |
| SSM | stralsakerhetsmyndigheten.se | Radiation safety regulations |
| Swedac | swedac.se | Accreditation regulations |

### Document Characteristics

These are generally smaller, more focused regulations compared to the omnibus AFS documents. Most are 5-30 pages. The main risk is locating PDFs on older/less-organized authority websites.

### Stub Records

Story 12.1 may not have created stubs for all of these (it created ~51 total). The ingestion script should handle both:
- Updating existing stubs (upsert on `document_number`)
- Creating new records where no stub exists

### Template Mapping

From `data/seed-template-documents.csv`:
- ELSÄK-FS: all Arbetsmiljö only
- KIFS: both templates (shared)
- BFS 2011:16: both templates (shared)
- SRVFS 2004:3: both, SRVFS 2004:7: Miljö only
- SKVFS 2015:6: Arbetsmiljö only
- SCB-FS, SSMFS, STAFS: Miljö only

## Testing

### Unit Tests

- Reuse tests from Story 9.2 — verify ingestion script handles documents from multiple authorities
- Verify graceful error handling when a PDF cannot be processed

### Testing Standards

- **Framework:** Vitest with `happy-dom` environment
- **Mocking:** `vi.mock()` for `@prisma/client` and `@anthropic-ai/sdk`
- **No real LLM calls in tests**

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-02-10 | 0.1 | Initial draft created from Epic 9 analysis | Sarah (PO) |

## Dev Agent Record

### Agent Model Used
*To be filled during implementation*

### Debug Log References
*To be filled during implementation*

### Completion Notes List
*To be filled during implementation*

### File List
*To be filled during implementation*

## QA Results
*To be filled after QA review*
