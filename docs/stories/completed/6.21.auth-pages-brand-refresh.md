# Story 6.21: Auth Pages Brand Refresh & Swedish Localization

## Status

Done

## Story

**As a** visitor arriving at the login, signup, password reset, or email verification pages,
**I want** a polished, on-brand experience in Swedish that matches the warmth and professionalism of the landing page,
**so that** I feel confident I'm using a premium, trustworthy Swedish product from the first interaction.

## Acceptance Criteria

**Brand & Visual Alignment:**

1. All auth pages (login, signup, reset-password, verify-email) use the Safiro font (`font-safiro`) for primary headings, matching the landing page's editorial typography style
2. Auth page backgrounds use the warm brand palette (off-white `bg-section-warm` or subtle mesh gradient) instead of plain `bg-gray-50`
3. The Laglig.se logo/wordmark appears at the top of each auth page, linking back to the landing page
4. Primary action buttons use the brand's deep blue (`primary`) with the landing page's shadow-glow hover effect
5. Color accents follow the established brand palette: deep blue primary, amber/orange warm accents, emerald success states
6. Auth layout maintains generous whitespace and rounded corners (`rounded-lg` / `rounded-xl`) matching the landing page card style

**Swedish Localization:**

7. All user-facing text on all four auth pages is in Swedish (headings, labels, placeholders, buttons, error messages, links, success messages)
8. Form validation error messages from Zod schemas render in Swedish
9. Page metadata (title, description) is in Swedish

**Remember Me (Login Page):**

10. Login form includes a "Kom ihåg min e-post" checkbox between the password field and the submit button
11. When checked, the email address is persisted to `localStorage` on successful login
12. On subsequent visits, the email field is pre-populated from `localStorage` if a value exists
13. Unchecking the checkbox and submitting clears the stored email from `localStorage`

**Component & Quality Standards:**

14. Raw HTML `<input>` elements are replaced with shadcn/ui `Input`, `Label`, `Button`, and `Checkbox` components
15. Form layout uses shadcn/ui `Card` (CardHeader, CardContent, CardFooter) for the auth form container
16. All auth pages remain fully functional — login, signup, password reset request, password reset confirmation, and email verification flows work unchanged
17. Pages are responsive across desktop and mobile breakpoints
18. Keyboard navigation and focus states work correctly on all form elements (WCAG AA)

## Tasks / Subtasks

- [x] **Task 1: Update auth layout with brand styling** (AC: 2, 3, 6, 9)
  - [x] Replace `bg-gray-50` with warm brand background (`bg-section-warm` or `bg-mesh-subtle` from `globals.css`) [Source: architecture/6-components.md#6.3.1]
  - [x] Add Laglig.se logo at top of layout using `next/image` with `src="/images/logo-final.png"` `alt="Laglig.se"` `width={176} height={67}` and `className="h-8 w-auto"` — match navbar pattern from `components/shared/navigation/navbar.tsx:148`
  - [x] Logo must link to `/` using `next/link`
  - [x] Wrap `{children}` in shadcn/ui `Card` with `rounded-xl shadow-lg` and white background
  - [x] Update layout `metadata` to a generic Swedish fallback: `title: 'Konto | Laglig.se'`, `description: 'Logga in eller skapa konto på Laglig.se'` — individual pages override with specific titles (see Tasks 2-5)
  - [x] Optional: Add `animate-fade-up` entrance animation on the Card

- [x] **Task 2: Refactor login page** (AC: 1, 4, 5, 7, 9, 10–16)
  - [x] Export page-specific metadata: `export const metadata = { title: 'Logga in | Laglig.se', description: 'Logga in på ditt Laglig.se-konto' }`
  - [x] Replace all raw `<input>` with shadcn/ui `Input` + `Label` components [Source: architecture/17-coding-standards.md#17.3]
  - [x] Replace raw `<button>` with shadcn/ui `Button` — add brand glow: `className="w-full shadow-lg shadow-primary/25 hover:shadow-xl hover:shadow-primary/30"`
  - [x] Add `font-safiro` class to the page heading (`<h2>`)
  - [x] Translate ALL user-facing text to Swedish:
    - Heading: "Logga in på ditt konto"
    - Email label/placeholder: "E-postadress"
    - Password label/placeholder: "Lösenord"
    - Submit button: "Logga in" / loading: "Loggar in..."
    - Signup link: "Skapa ett nytt konto"
    - Forgot password link: "Glömt ditt lösenord?"
    - Error messages: "Ogiltig e-postadress eller lösenord", "Ett fel uppstod. Försök igen."
    - Success message (from URL param): translate `ERROR_MESSAGES` map values to Swedish — note: the `'Password'` key is a legacy oddity that routes a success message through the error-param mechanism; add a `// NOTE: 'Password' key displays a success message via ?error= param (legacy from reset-password confirm flow)` comment for clarity
  - [x] Add "Kom ihåg min e-post" shadcn/ui `Checkbox` + `Label` between password field and submit button
  - [x] Implement `localStorage` remember-me logic:
    - `useEffect` on mount: read `localStorage.getItem('laglig-remember-email')`, if exists call `setValue('email', savedEmail)` and `setRememberMe(true)`
    - On successful submit: if `rememberMe` is true, `localStorage.setItem(...)`, else `localStorage.removeItem(...)`
  - [x] Replace inline error/success `<div>` elements with styled alerts using brand colors: `bg-destructive/10 text-destructive` for errors, `bg-emerald-50 text-emerald-800` for success [Source: prd/user-interface-design-goals.md — color palette]

- [x] **Task 3: Refactor signup page** (AC: 1, 4, 5, 7, 9, 14, 15)
  - [x] Export page-specific metadata: `export const metadata = { title: 'Skapa konto | Laglig.se', description: 'Registrera dig på Laglig.se' }`
  - [x] Replace all raw `<input>` with shadcn/ui `Input` + `Label`
  - [x] Replace raw `<button>` with shadcn/ui `Button` with brand glow
  - [x] Add `font-safiro` to heading
  - [x] Translate ALL text to Swedish:
    - Heading: "Skapa ditt konto"
    - Name label/placeholder: "Fullständigt namn"
    - Email label/placeholder: "E-postadress"
    - Password label/placeholder: "Lösenord" / "Minst 12 tecken"
    - Confirm password label/placeholder: "Bekräfta lösenord"
    - Submit button: "Skapa konto" / loading: "Skapar konto..."
    - Login link: "Har du redan ett konto?" / "Logga in"
    - Password strength labels: "svag" / "medel" / "stark"
    - Password requirements: "Måste innehålla versal, gemen, siffra och specialtecken"
    - Success state heading: "Kontrollera din e-post"
    - Success state text: "Vi har skickat en verifieringslänk till din e-postadress. Klicka på länken för att aktivera ditt konto."
    - Return to login: "Tillbaka till inloggningen"
  - [x] Replace inline SVG checkmark icon with Lucide `CheckCircle` or `Check` icon [Source: architecture/3-tech-stack.md#3.1 — Lucide Icons]
  - [x] Maintain password strength indicator, just translate labels

- [x] **Task 4: Refactor reset-password pages** (AC: 1, 4, 5, 7, 9, 14, 15)
  - [x] **reset-password/page.tsx** — Export metadata: `export const metadata = { title: 'Återställ lösenord | Laglig.se', description: 'Återställ ditt lösenord' }`
  - [x] **reset-password/confirm/page.tsx** — Export metadata: `export const metadata = { title: 'Nytt lösenord | Laglig.se', description: 'Ange ditt nya lösenord' }`
  - [x] **reset-password/page.tsx** — Replace raw inputs with shadcn/ui, translate:
    - Heading: "Återställ ditt lösenord"
    - Description: "Ange din e-postadress så skickar vi en länk för att återställa ditt lösenord."
    - Email label/placeholder: "E-postadress"
    - Submit button: "Skicka återställningslänk" / loading: "Skickar..."
    - Back link: "Tillbaka till inloggningen"
    - Success heading: "Kontrollera din e-post"
    - Success text: "Vi har skickat en länk för att återställa ditt lösenord."
  - [x] **reset-password/confirm/page.tsx** — Replace raw inputs with shadcn/ui, translate:
    - Heading: "Ange nytt lösenord"
    - Description: "Ange ditt nya lösenord nedan."
    - Password label/placeholder: "Nytt lösenord" / "Minst 12 tecken"
    - Confirm label/placeholder: "Bekräfta nytt lösenord"
    - Submit button: "Uppdatera lösenord" / loading: "Uppdaterar lösenord..."
    - Password requirements hint: translate to Swedish
    - Success redirect message: update URL param to Swedish — `router.push('/login?message=Lösenordet har uppdaterats')`
  - [x] Replace inline SVG icons with Lucide equivalents (`CheckCircle`, `Mail`)

- [x] **Task 5: Refactor verify-email page** (AC: 1, 5, 7, 9, 14)
  - [x] Export page-specific metadata: `export const metadata = { title: 'Verifiera e-post | Laglig.se', description: 'Verifiera din e-postadress' }`
  - [x] Note: This page is currently a Server Component (no `'use client'`) — keep it as a Server Component
  - [x] Replace inline SVG mail icon with Lucide `Mail` icon
  - [x] Add `font-safiro` to heading
  - [x] Translate all text:
    - Heading: "Kontrollera din e-post"
    - Description: "Vi har skickat en verifieringslänk till din e-postadress. Klicka på länken för att aktivera ditt konto."
    - Spam hint: "Fick du inget mejl? Kontrollera din skräppost."
    - Return link: "Tillbaka till inloggningen"

- [x] **Task 6: Update Zod validation schemas for Swedish error messages** (AC: 8)
  - **Sequence note**: Ideally complete this task before Tasks 2-5 so Swedish validation messages are available when testing page refactors
  - [x] File: `lib/validation/auth.ts`
  - [x] `PasswordSchema`:
    - `'Lösenordet måste vara minst 12 tecken'`
    - `'Måste innehålla minst en versal'`
    - `'Måste innehålla minst en gemen'`
    - `'Måste innehålla minst en siffra'`
    - `'Måste innehålla minst ett specialtecken'`
  - [x] `SignupSchema`:
    - `'Ogiltig e-postadress'`
    - `'Namnet måste vara minst 2 tecken'`
    - `'Lösenorden matchar inte'`
  - [x] `LoginSchema`:
    - `'Ogiltig e-postadress'`
    - `'Lösenord krävs'`
  - [x] `ResetPasswordSchema`:
    - `'Ogiltig e-postadress'`
  - [x] `ConfirmPasswordSchema`:
    - `'Lösenorden matchar inte'`

- [x] **Task 7: Regression testing & responsive verification** (AC: 16, 17, 18)
  - [x] Verify login flow: valid credentials → redirect to dashboard, invalid → Swedish error, callbackUrl preserved
  - [x] Verify signup flow: form submission → server action call → success state in Swedish
  - [x] Verify password reset flow: request → success state, confirm → redirect to login with Swedish message
  - [x] Verify email verification page renders correctly with Swedish text
  - [x] Test remember-me lifecycle: check checkbox → login → revisit → email pre-populated; uncheck → login → revisit → email empty
  - [x] Verify responsive layout on mobile (320px) and desktop (1280px+) — Card should scale appropriately
  - [x] Verify keyboard tab order through all form elements, visible focus rings on all interactive elements [Source: architecture/section-9-summary.md#10.8 — Accessibility]
  - [x] Verify Lucide icons render correctly where they replaced inline SVGs

## Dev Notes

### Architecture Sources

This story draws from the following architecture documents:

- **Frontend Architecture**: Next.js 16 App Router, Server Components by default, client components only when needed [Source: architecture/section-9-summary.md#10.1, #10.2]
- **Component Standards**: shadcn/ui mandatory for all UI components, Radix UI primitives for accessibility [Source: architecture/17-coding-standards.md#17.3]
- **Tech Stack**: React Hook Form 7.51+ for forms, Zod 3.22+ for validation, Lucide Icons 0.365+ [Source: architecture/3-tech-stack.md#3.1]
- **Auth Components**: Sign-in, Sign-up, OAuth, Password Reset component specifications [Source: architecture/6-components.md#6.3.1]
- **Project Structure**: Auth routes under `app/(auth)/`, validation under `lib/validation/` [Source: architecture/12-unified-project-structure.md#12.2]
- **Accessibility**: WCAG 2.1 AA compliance target, semantic HTML, ARIA labels, keyboard navigation [Source: architecture/section-9-summary.md#10.8]
- **Design System**: "Coolt med koll" — minimalist, OpenAI-inspired, deep blue primary, generous whitespace, 8px border-radius [Source: prd/user-interface-design-goals.md]
- **Testing Strategy**: Vitest + React Testing Library for components, Playwright for E2E [Source: architecture/section-15-summary.md#16.1, #16.2]

### Relevant Source Tree

```
app/(auth)/
  layout.tsx                      # Auth layout — brand background, logo, Card wrapper, Swedish metadata
  login/page.tsx                  # Login — 'use client', shadcn/ui, Swedish, remember-me
  signup/page.tsx                 # Signup — 'use client', shadcn/ui, Swedish, password strength
  reset-password/page.tsx         # Reset request — 'use client', shadcn/ui, Swedish
  reset-password/confirm/page.tsx # Reset confirm — 'use client', shadcn/ui, Swedish
  verify-email/page.tsx           # Verify — Server Component (NO 'use client'), shadcn/ui, Swedish

lib/validation/auth.ts            # Zod schemas — 4 schemas, all error messages → Swedish

public/fonts/
  safiro-medium-webfont.woff2     # Brand font (loaded via @font-face in globals.css)
  safiro-medium-webfont.woff      # Fallback

public/images/
  logo-final.png                  # Logo used in navbar — reuse for auth pages

app/globals.css                   # Brand utilities: font-safiro, bg-section-warm, bg-mesh-subtle,
                                  # animate-fade-up, card-hover, glow, text-gradient, etc.

components/ui/
  button.tsx                      # shadcn/ui Button (existing)
  input.tsx                       # shadcn/ui Input (existing)
  label.tsx                       # shadcn/ui Label (existing)
  checkbox.tsx                    # shadcn/ui Checkbox (existing)
  card.tsx                        # shadcn/ui Card (existing)

components/shared/navigation/
  navbar.tsx                      # Logo pattern reference (line 146-151): Image src, sizing, invert class
```

### Brand Styling Reference (from landing page)

All brand styling utilities are defined in `app/globals.css` and `tailwind.config.ts`. Use these existing utilities — do NOT create new ones or hardcode hex values.

- **Safiro font**: `font-safiro` class — defined via `@font-face` in `globals.css` with `safiro-medium-webfont.woff2`. Apply to primary headings only, matching landing page hero style [Source: globals.css, components/features/landing/hero-section.tsx]
- **Warm background**: `bg-section-warm` (CSS class in `globals.css`) or `bg-mesh-subtle` for subtle gradient mesh. Replaces current `bg-gray-50`
- **Button glow**: Landing page primary buttons use shadow with primary color glow — replicate with `shadow-lg shadow-primary/25 hover:shadow-xl hover:shadow-primary/30` [Source: components/features/landing/hero-section.tsx — CTA button pattern]
- **Card styling**: `rounded-xl` with `shadow-lg` and white `bg-card` background [Source: prd/user-interface-design-goals.md — 8px border-radius, subtle shadows]
- **Animations**: `animate-fade-up` on the Card for subtle entrance effect (defined in `globals.css` with delay variants: `animate-fade-up-delay-1`, `delay-2`, `delay-3`)
- **Color tokens**: Use CSS variable-based semantic colors from the theme system — `primary`, `destructive`, `muted`, `muted-foreground`, `card`, `card-foreground`, etc. NEVER hardcode hex values like `text-gray-900` or `bg-blue-600` [Source: architecture/17-coding-standards.md#17.3]
- **Success states**: Use `bg-emerald-50 text-emerald-800` for success alerts (emerald = compliance success per brand palette)
- **Error states**: Use `bg-destructive/10 text-destructive` for error alerts

### Logo Implementation Pattern

Reference the existing navbar implementation at `components/shared/navigation/navbar.tsx:146-151`:

```tsx
import Image from 'next/image'
import Link from 'next/link'

;<Link href="/" className="transition-opacity hover:opacity-90">
  <Image
    src="/images/logo-final.png"
    alt="Laglig.se"
    width={176}
    height={67}
    className="h-8 w-auto"
  />
</Link>
```

Note: The navbar uses `invert dark:invert-0` for dark mode — auth pages do NOT need this since they use a light warm background.

### Remember Me Implementation

```typescript
const REMEMBER_EMAIL_KEY = 'laglig-remember-email'

// State
const [rememberMe, setRememberMe] = useState(false)

// On mount (inside useEffect):
const savedEmail = localStorage.getItem(REMEMBER_EMAIL_KEY)
if (savedEmail) {
  setValue('email', savedEmail) // React Hook Form setValue
  setRememberMe(true)
}

// On successful submit (inside onSubmit, after signIn succeeds):
if (rememberMe) {
  localStorage.setItem(REMEMBER_EMAIL_KEY, validated.email)
} else {
  localStorage.removeItem(REMEMBER_EMAIL_KEY)
}
```

### Important Implementation Notes

1. **verify-email/page.tsx is a Server Component** — it has no `'use client'` directive and no client-side state. Keep it as a Server Component. shadcn/ui components that don't require interactivity (like static Card layout) work in Server Components. For Lucide icons, import directly — they are React components that work in both contexts.

2. **Existing auth logic must NOT change** — the story is purely a visual/localization refresh. Do not modify `signIn()`, `signupAction()`, `supabase.auth.resetPasswordForEmail()`, `supabase.auth.updateUser()`, or any callback/redirect logic. Only change the UI layer and text strings.

3. **React Hook Form integration** — all pages already use `useForm` with `register()`. When switching from raw `<input>` to shadcn/ui `Input`, continue using `{...register('fieldName')}` spread — shadcn/ui `Input` accepts the same props. [Source: architecture/3-tech-stack.md#3.1 — React Hook Form 7.51+]

4. **Zod schema changes are safe** — changing error message strings does not affect validation logic. The `.min()`, `.regex()`, `.email()`, and `.refine()` rules remain identical.

5. **The layout wraps ALL auth pages** — changes to `layout.tsx` (background, logo, Card wrapper) automatically apply to all 5 pages. Individual page refactors only need to handle content within the Card.

### Coding Standards

- Use shadcn/ui components exclusively — no raw HTML form elements [Source: architecture/17-coding-standards.md#17.3]
- TypeScript strict mode — all new code fully typed [Source: architecture/17-coding-standards.md#17.2]
- Use theme color tokens (not hardcoded hex) for all colors [Source: prd/user-interface-design-goals.md]
- Follow existing React Hook Form + Zod pattern already in auth pages [Source: architecture/3-tech-stack.md#3.1]
- Keep `'use client'` directive on pages that need it — auth pages with forms need client-side interactivity
- Import path aliases: `@/components/ui/button`, `@/lib/validation/auth` [Source: architecture/12-unified-project-structure.md#12.5]
- Lucide Icons for any iconography: `import { Mail, CheckCircle } from 'lucide-react'` [Source: architecture/3-tech-stack.md#3.1]

### Testing

- **Test approach**: Manual regression testing — this story is purely UI styling and text localization with one small feature (remember-me localStorage). No unit tests required for CSS/text changes. [Source: architecture/section-15-summary.md#16.1 — testing pyramid]
- **Critical flows to verify manually**:
  - Login with valid/invalid credentials → correct redirect/error
  - Signup with all validation errors triggered → Swedish messages
  - Password reset request → success state
  - Password reset confirm → redirect to login with Swedish URL param
  - Email verification page renders with Swedish text
- **Remember me**: Verify full localStorage read/write/clear cycle across page visits
- **Responsive**: Verify at 320px mobile and 1280px+ desktop [Source: prd/user-interface-design-goals.md — responsive breakpoints]
- **Accessibility**: Tab through all form fields, verify visible focus rings, verify `Label` components correctly associate with inputs via `htmlFor` [Source: architecture/section-9-summary.md#10.8]
- **Test file location (if unit tests added later)**: `tests/unit/app/(auth)/` mirroring source tree [Source: architecture/12-unified-project-structure.md#12.2]

## Change Log

| Date       | Version | Description                                                                                                                                                                    | Author     |
| ---------- | ------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ---------- |
| 2026-01-30 | 1.0     | Initial story creation                                                                                                                                                         | Sarah (PO) |
| 2026-01-30 | 1.1     | SM review: Added architecture source citations, detailed Swedish translations, logo pattern, implementation notes, enriched tasks with file-level specifics                    | Bob (SM)   |
| 2026-01-30 | 1.2     | PO validation: Added per-page metadata subtasks (AC 9), task sequence note on Task 6, ERROR_MESSAGES comment guidance, added Dev Agent Record and QA Results template sections | Sarah (PO) |

## Dev Agent Record

### Agent Model Used

Claude Opus 4.5 (claude-opus-4-5-20251101)

### Debug Log References

No debug issues encountered. TypeScript type check and ESLint both pass cleanly.

### Completion Notes List

- Task 6 completed first per sequence note — all Zod schema error messages translated to Swedish
- Task 1: Auth layout updated with `bg-section-warm`, logo via `next/image` + `next/link`, shadcn/ui `Card` wrapper with `animate-fade-up`, Swedish metadata
- Task 2: Login page split into Server Component (page.tsx with metadata) + Client Component (\_login-form.tsx). shadcn/ui components, full Swedish translation, remember-me checkbox with localStorage, brand glow button, `ERROR_MESSAGES` translated with legacy `Password` key comment
- Task 3: Signup page split into Server Component + Client Component (\_signup-form.tsx). shadcn/ui, Swedish text, Lucide `CheckCircle` replacing inline SVG, password strength labels translated (svag/medel/stark)
- Task 4: Both reset-password pages split into Server + Client components. shadcn/ui, Swedish text, Lucide `CheckCircle` icon, confirm page redirects with Swedish URL param
- Task 5: Verify-email page kept as Server Component, Lucide `Mail` icon, `font-safiro` heading, Swedish text
- All auth logic (signIn, signupAction, supabase.auth.\*) remains unchanged — purely UI/text changes
- Fix: `metadata` cannot be exported from `'use client'` components in Next.js — split all 4 client pages into Server Component (page.tsx exports metadata) + Client Component (underscore-prefixed form file)

### File List

- `lib/validation/auth.ts` — Modified: All Zod error messages translated to Swedish
- `app/(auth)/layout.tsx` — Modified: Brand background, logo, Card wrapper, Swedish metadata, fade-up animation
- `app/(auth)/login/page.tsx` — Modified: Server Component shell with metadata, renders LoginForm
- `app/(auth)/login/_login-form.tsx` — New: Client Component with login form, shadcn/ui, Swedish text, remember-me
- `app/(auth)/signup/page.tsx` — Modified: Server Component shell with metadata, renders SignupForm
- `app/(auth)/signup/_signup-form.tsx` — New: Client Component with signup form, shadcn/ui, Swedish text, Lucide CheckCircle
- `app/(auth)/reset-password/page.tsx` — Modified: Server Component shell with metadata, renders ResetPasswordForm
- `app/(auth)/reset-password/_reset-password-form.tsx` — New: Client Component with reset form, shadcn/ui, Swedish text
- `app/(auth)/reset-password/confirm/page.tsx` — Modified: Server Component shell with metadata, renders ConfirmPasswordForm
- `app/(auth)/reset-password/confirm/_confirm-password-form.tsx` — New: Client Component with confirm form, shadcn/ui, Swedish text
- `app/(auth)/verify-email/page.tsx` — Modified: Lucide Mail icon, font-safiro, Swedish text, typed Metadata export

## QA Results

_To be filled by QA agent_
