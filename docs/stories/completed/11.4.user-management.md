# Story 11.4: User Management

## Status

Done

## Story

**As an** admin,
**I want** to browse and search all users on the platform,
**so that** I can look up customer information and understand their workspace memberships.

## Acceptance Criteria

1. User list page at `/admin/users`
2. Searchable data table (TanStack Table) with columns: Name, Email, Last Login, Workspace Count, Created Date
3. Search by name or email (server-side filtering via query params)
4. Sortable by any column (server-side sorting)
5. Paginated (25 per page, server-side)
6. Click a user row to navigate to detail view at `/admin/users/[id]`
7. Detail view shows:
   - User info (name, email, avatar URL, created date, last login — formatted as relative time)
   - Workspace memberships table (workspace name, role, subscription tier, joined date)
   - "Logga in som användare" (Impersonate) button — placeholder only, implemented in Story 11.5
8. Read-only — no user editing from admin (users manage their own profile)

## Tasks / Subtasks

- [x] **Task 1: Create user list query** (AC: 2, 3, 4, 5)
  - [x] Add to `lib/admin/queries.ts`:
  - [x] `getUserList(params)` — accepts `{ search?: string | undefined, sortBy?: string | undefined, sortDir?: 'asc' | 'desc' | undefined, page?: number | undefined, pageSize?: number | undefined }`
  - [x] Build dynamic Prisma `where` clause:
    - If `search`: match against `name` or `email` using `contains` (case-insensitive via `mode: 'insensitive'`)
  - [x] Return `{ data: UserListItem[], total: number, page: number, pageSize: number }`
  - [x] Use `select` to fetch: id, name, email, last_login_at, created_at, `_count: { select: { workspace_members: true } }`
  - [x] Add sort field allowlist (same pattern as `getWorkspaceList`): `name`, `email`, `last_login_at`, `created_at`
  - [x] Use `Promise.all()` for parallel `findMany` + `count` queries [Source: architecture/17-coding-standards.md#17.7]
  - [x] Default sort: `created_at` desc
  - [x] Export `UserListItem` and `UserListParams` types

- [x] **Task 2: Create user detail query** (AC: 7)
  - [x] Add to `lib/admin/queries.ts`:
  - [x] `getUserDetail(id: string)` — returns user with:
    - User fields: id, name, email, avatar_url, created_at, last_login_at
    - Workspace memberships via `workspace_members` relation:
      ```typescript
      workspace_members: {
        select: {
          role: true,
          joined_at: true,
          workspace: {
            select: { id: true, name: true, slug: true, subscription_tier: true, status: true }
          }
        }
      }
      ```
  - [x] Return `null` if user not found (use `findUnique`)
  - [x] Export `UserDetail` type

- [x] **Task 3: Create user list page** (AC: 1, 2, 3, 4, 5, 6)
  - [x] Create `app/admin/(dashboard)/users/page.tsx` — Server Component
  - [x] `searchParams` is `Promise` in Next.js 16 — must `await`:
    ```typescript
    export default async function UsersPage({
      searchParams,
    }: {
      searchParams: Promise<Record<string, string | string[] | undefined>>
    }) {
      const params = await searchParams
      // ... parse params
    }
    ```
  - [x] Parse search/sort/page from resolved params (use `typeof x === 'string'` guards)
  - [x] Call `getUserList()` with parsed params
  - [x] Set `export const dynamic = 'force-dynamic'`
  - [x] Render `UserTable` client component with data + pagination info + current filter state as props
  - [x] Create `components/admin/user-table.tsx` — `'use client'` component:
    - TanStack Table following same pattern as `workspace-table.tsx` from Story 11.3
    - Reuse `useUpdateSearchParams` hook pattern and `SortableHeader` component pattern from `workspace-table.tsx`
    - Search input at top (debounced 300ms, updates URL search params)
    - Column header sorting (updates URL search params `sortBy`, `sortDir`)
    - Pagination controls at bottom (updates URL search params `page`)
    - Row click navigates to `/admin/users/${row.id}` via `useRouter().push()`
    - Format `last_login_at` as relative time ("3 timmar sedan") or "Aldrig" if null
    - Show "Inga användare hittades" when data is empty

- [x] **Task 4: Create user detail page** (AC: 6, 7, 8)
  - [x] Create `app/admin/(dashboard)/users/[id]/page.tsx` — Server Component
  - [x] `params` is `Promise` in Next.js 16 — must `await`:
    ```typescript
    export default async function UserDetailPage({
      params,
    }: {
      params: Promise<{ id: string }>
    }) {
      const { id } = await params
      // ...
    }
    ```
  - [x] Fetch user detail via `getUserDetail(id)`
  - [x] Show `notFound()` from `next/navigation` if user is null
  - [x] Set `export const dynamic = 'force-dynamic'`
  - [x] Render user info section (Card with key-value pairs):
    - Name, Email, Avatar (image or placeholder), Created date, Last login (relative)
  - [x] Render workspace memberships table (shadcn/ui Table — simple, no TanStack needed):
    - Columns: Workspace Name (link to `/admin/workspaces/${workspace.id}`), Role (Swedish label via `ROLE_LABELS`), Tier (badge via `TIER_LABELS`), Status (badge via `STATUS_LABELS`/`STATUS_VARIANT`), Joined date
  - [x] Render disabled "Logga in som användare" button with tooltip "Kommer i nästa story" — placeholder for Story 11.5
  - [x] If user has no workspace memberships, show "Inga workspace-medlemskap" message
  - [x] Back link to `/admin/users` at top of page

- [x] **Task 5: Testing** (AC: all)
  - **Automated (Vitest)** — extend `tests/unit/lib/admin/queries.test.ts`:
  - [x] Test: `getUserList()` with no filters returns paginated result shape
  - [x] Test: `getUserList()` with search parameter builds correct `where` clause (OR on name/email)
  - [x] Test: `getUserList()` pagination calculates correct `skip` and `take`
  - [x] Test: `getUserList()` falls back to `created_at` for invalid sort field
  - [x] Test: `getUserDetail()` returns user with workspace memberships
  - [x] Test: `getUserDetail()` returns null for non-existent user
  - **Manual:**
  - [ ] Test: search and paginate user list
  - [ ] Test: click user → detail view loads with memberships
  - [ ] Test: workspace links in detail view navigate correctly
  - [ ] Test: user with no workspaces shows empty state
  - [ ] Test: last login shows "Aldrig" for users who have never logged in

## Dev Notes

### Previous Story Insights

**From Story 11.3 (Workspace Management) — Done:**

- `lib/admin/queries.ts` already exists with 6 exported functions and types (`WorkspaceMetrics`, `UserMetrics`, `RecentWorkspace`, `RecentUser`, `WorkspaceListItem`, `WorkspaceDetail`). Add `getUserList()` and `getUserDetail()` to this same file. [Source: lib/admin/queries.ts]
- `lib/admin/constants.ts` already exports `STATUS_LABELS`, `STATUS_VARIANT`, `TIER_LABELS`, and `ROLE_LABELS` — import these directly, do NOT redefine locally [Source: lib/admin/constants.ts:1-35]
- `components/admin/workspace-table.tsx` establishes the TanStack Table pattern with `useUpdateSearchParams` hook (line 53-70) and `SortableHeader` component (line 353-384). Follow this exact pattern for `user-table.tsx`. [Source: components/admin/workspace-table.tsx]
- `export const dynamic = 'force-dynamic'` is required on all admin pages [Source: app/admin/(dashboard)/dashboard/page.tsx:23]
- `searchParams` is `Promise` in Next.js 16 — must `await` before accessing properties [Source: app/admin/(dashboard)/workspaces/page.tsx]
- `params` is also `Promise` in Next.js 16 for dynamic route segments [Source: app/admin/(dashboard)/workspaces/[id]/page.tsx]
- Prisma mock pattern: `vi.mock('@/lib/prisma', () => ({ prisma: { ... } }))` then `vi.mocked(prisma.model.method)` [Source: tests/unit/lib/admin/queries.test.ts]
- `as never` cast needed on Prisma mock return values for type safety [Source: tests/unit/lib/admin/queries.test.ts:36]
- `exactOptionalPropertyTypes: true` requires `| undefined` on optional interface props — e.g. `search?: string | undefined` [Source: tsconfig.json:16]
- `noUncheckedIndexedAccess: true` requires optional chaining on array index access [Source: tsconfig.json:15]
- `noUnusedLocals: true` and `noUnusedParameters: true` enforced [Source: tsconfig.json:11-12]
- Sort field allowlist pattern for safety — use `Set.has()` to validate sort field, fall back to `created_at` [Source: lib/admin/queries.ts:161-167]
- Empty state handling: conditional row with `colSpan` and "Inga ... hittades" message [Source: components/admin/workspace-table.tsx:304-313]
- Pagination text: show "Inga ... att visa" when total is 0, otherwise show "Visar X–Y av Z" [Source: components/admin/workspace-table.tsx:320-323]
- `redirect()` must be called outside try/catch in server actions (Next.js throws NEXT_REDIRECT internally) [Source: 11.1 completion notes]
- 20 pre-existing failing tests (redis, caching, auth signup) exist — zero new failures expected

**From Story 11.1 (Admin Auth & Shell Layout) — Done:**

- Admin sidebar already has `/admin/users` link with `Users` icon [Source: components/admin/admin-sidebar.tsx:11]
- `getAdminSession()` returns `{ email: string } | null` from `admin_session` cookie [Source: lib/admin/auth.ts]

### Dependencies

- **Blocked by:** Story 11.1 (Admin Auth & Shell Layout) — Done ✓
- **Extends:** Story 11.3 (Workspace Management) — Done ✓: reuses `lib/admin/queries.ts`, shared constants, TanStack Table pattern
- **Independent of:** Stories 11.6, 11.7
- **Blocks:** Story 11.5 (User Impersonation) — impersonate button placed on user detail page

### Architecture Context

This story follows the exact same pattern as Story 11.3 (Workspace Management) for the TanStack Table. The key difference is that this story is **read-only** — no server actions or mutations needed (unlike 11.3 which had tier/status change actions). This significantly reduces complexity.

**Server-side table pattern (established in 11.3):** All filtering, sorting, and pagination happen on the server via Prisma queries. The client component reads data as props and uses URL search params to control the server query. This avoids loading all users into the client. [Source: architecture/17-coding-standards.md#17.3]

### Relevant Source Tree

```
app/admin/(dashboard)/
  users/
    page.tsx                          # NEW: User list page (Server Component)
    [id]/
      page.tsx                        # NEW: User detail page (Server Component)

components/admin/
  user-table.tsx                      # NEW: 'use client' TanStack Table

lib/admin/
  queries.ts                          # EXTEND: Add getUserList(), getUserDetail()
  constants.ts                        # READ: Import ROLE_LABELS, TIER_LABELS, STATUS_LABELS, STATUS_VARIANT

# REFERENCE FILES (read but do not modify):
prisma/schema.prisma
  - User model (line ~20): id, name, email, avatar_url, last_login_at, created_at
  - WorkspaceMember model (line ~105): user_id, workspace_id, role, joined_at (NOT created_at)
  - Workspace model (line ~57): id, name, slug, subscription_tier, status
components/admin/workspace-table.tsx  # REFERENCE: TanStack Table pattern, useUpdateSearchParams, SortableHeader
lib/admin/auth.ts                     # READ: getAdminSession() — not needed for this story (read-only)
```

### Key Implementation Details

1. **TanStack Table reuse.** The table pattern from Story 11.3 should be followed exactly — same `useUpdateSearchParams` hook, same `SortableHeader` component, same debounced search, same pagination controls. Consider extracting shared table utilities (the `useUpdateSearchParams` hook and `SortableHeader` component) into `components/admin/table-utils.tsx` if the duplication is significant, OR simply duplicate the pattern (both are acceptable approaches). [Source: components/admin/workspace-table.tsx]

2. **ROLE_LABELS — import from shared constants.** `ROLE_LABELS` already exists in `lib/admin/constants.ts` (moved there during Story 11.3 QA fixes). Do NOT redefine locally. Import it:

   ```typescript
   import {
     ROLE_LABELS,
     TIER_LABELS,
     STATUS_LABELS,
     STATUS_VARIANT,
   } from '@/lib/admin/constants'
   ```

   Current values in `lib/admin/constants.ts`:

   ```typescript
   ROLE_LABELS = {
     OWNER: 'Ägare',
     ADMIN: 'Admin',
     HR_MANAGER: 'HR-ansvarig',
     MEMBER: 'Medlem',
     AUDITOR: 'Revisor',
   }
   ```

   [Source: lib/admin/constants.ts:29-35]

3. **Last login formatting:**

   ```typescript
   import { formatDistanceToNow } from 'date-fns'
   import { sv } from 'date-fns/locale'

   function formatLastLogin(date: Date | null): string {
     if (!date) return 'Aldrig'
     return formatDistanceToNow(date, { addSuffix: true, locale: sv })
   }
   ```

   [Source: architecture/3-tech-stack.md — date-fns 3.3+]

4. **CRITICAL: Prisma relation name is `workspace_members` NOT `workspaces`.** The User model's relation to WorkspaceMember is named `workspace_members` (plural with underscore). The joined date field on WorkspaceMember is `joined_at` (NOT `created_at`).

   ```typescript
   // Correct user detail query with workspace memberships:
   prisma.user.findUnique({
     where: { id },
     select: {
       id: true,
       name: true,
       email: true,
       avatar_url: true,
       created_at: true,
       last_login_at: true,
       workspace_members: {
         select: {
           role: true,
           joined_at: true,
           workspace: {
             select: {
               id: true,
               name: true,
               slug: true,
               subscription_tier: true,
               status: true,
             },
           },
         },
       },
     },
   })
   ```

   For user list workspace count:

   ```typescript
   _count: {
     select: {
       workspace_members: true
     }
   }
   ```

   [Source: prisma/schema.prisma:31 — `workspace_members WorkspaceMember[] @relation("WorkspaceMemberUser")`]
   [Source: prisma/schema.prisma:119 — `joined_at DateTime @default(now())`]

5. **Cross-linking.** Workspace names in the user detail view should link to `/admin/workspaces/${workspace.id}` so the admin can navigate between users and workspaces seamlessly. Use Next.js `Link` component.

6. **Impersonate button placeholder.** Add a disabled `Button` with `variant="outline"` and text "Logga in som användare". Use a `Tooltip` or simple text to indicate "Kommer i nästa story". Story 11.5 will enable it and add the action. [Source: AC 7]

7. **URL search params pattern (from 11.3):**

   ```typescript
   // In page.tsx (Server Component) — searchParams is Promise in Next.js 16:
   export default async function UsersPage({
     searchParams,
   }: {
     searchParams: Promise<Record<string, string | string[] | undefined>>
   }) {
     const params = await searchParams
     const search = typeof params.search === 'string' ? params.search : undefined
     const sortBy = typeof params.sortBy === 'string' ? params.sortBy : 'created_at'
     const sortDir = params.sortDir === 'asc' ? 'asc' as const : 'desc' as const
     const page = typeof params.page === 'string' ? Math.max(1, parseInt(params.page, 10)) : 1

     const result = await getUserList({ search, sortBy, sortDir, page, pageSize: 25 })
     return <UserTable data={result.data} total={result.total} page={page} pageSize={25} ... />
   }
   ```

8. **Sort field allowlist.** Follow same pattern as `getWorkspaceList` — use a `Set` of allowed fields, fall back to `created_at` if the provided sortBy is not in the set. **Note:** `workspace_members` count (AC4 "sortable by any column") is a relational aggregate that cannot be sorted via Prisma `orderBy`. This is an acceptable limitation (same as Owner/Member Count in 11.3). Sortable columns: `name`, `email`, `last_login_at`, `created_at`. [Source: lib/admin/queries.ts:161-167]

### Coding Standards

- Server-side data fetching in Server Components [Source: architecture/17-coding-standards.md#17.3]
- TanStack Table for data tables (same pattern as 11.3) [Source: architecture/3-tech-stack.md — @tanstack/react-table 8.21.3]
- shadcn/ui components: Card, Table, Badge, Button, Input, Tooltip [Source: architecture/17-coding-standards.md#17.3]
- Prisma `select` for selective field fetching [Source: architecture/17-coding-standards.md#17.7]
- Parallel data fetching with `Promise.all()` [Source: architecture/17-coding-standards.md#17.7]
- URL search params for server-side filtering/pagination (no client state for table params)
- Swedish UI text throughout [Source: architecture/18-error-handling-strategy.md#18.5]
- `date-fns` with `sv` locale for all date formatting [Source: architecture/3-tech-stack.md — date-fns 3.3+]
- Import aliases: `@/lib/admin/...`, `@/components/admin/...` [Source: tsconfig.json:31-39]

### Testing

- **Test file location**: `tests/unit/lib/admin/queries.test.ts` (extend existing file — already has mock setup for `prisma.user`)
- **Testing framework**: Vitest [Source: architecture/3-tech-stack.md — Vitest 1.4+]
- **Note**: `tests/` directory is excluded from tsconfig `include` — Vitest has its own config [Source: tsconfig.json:49]
- **Mock strategy**: Extend existing `prisma` mock to add `user.findUnique` if not already present. Follow same `vi.mocked()` + `as never` cast pattern from existing workspace tests.
- **Pre-existing test failures**: ~20 known failing tests (redis, caching, auth signup) — zero new failures expected
- **Manual**: Full table interaction (search, sort, paginate), user detail view, cross-links to workspaces, last login formatting, empty states

## File List

- `lib/admin/queries.ts` — MODIFIED: Added `getUserList()`, `getUserDetail()`, `UserListItem`, `UserListParams`, `UserListResult`, `UserDetail` types
- `app/admin/(dashboard)/users/page.tsx` — NEW: User list page (Server Component)
- `app/admin/(dashboard)/users/[id]/page.tsx` — NEW: User detail page (Server Component)
- `components/admin/user-table.tsx` — NEW: Client-side TanStack Table for user list
- `tests/unit/lib/admin/queries.test.ts` — MODIFIED: Added 6 tests for `getUserList` and `getUserDetail`

## Dev Agent Record

### Agent Model Used

Claude Opus 4.5

### Debug Log References

No debug issues encountered.

### Completion Notes

- All 5 tasks completed, all automated subtasks checked off
- 20/20 unit tests pass (14 existing + 6 new) — zero regressions
- ESLint: zero errors on all new/modified files
- TypeScript: only pre-existing `@prisma/client` type resolution errors (Prisma client not generated in dev environment) — no new type errors introduced
- Followed exact TanStack Table pattern from Story 11.3 (`workspace-table.tsx`): `useUpdateSearchParams` hook, `SortableHeader` component, debounced search, URL-param-driven pagination
- Imported `ROLE_LABELS`, `TIER_LABELS`, `STATUS_LABELS`, `STATUS_VARIANT` from shared `lib/admin/constants.ts` — no local redefinitions
- Used `date-fns` `formatDistanceToNow` with `sv` locale for relative time display ("Aldrig" for null last_login_at)
- Impersonate button rendered as disabled `Button` with `Tooltip` "Kommer i nästa story" — ready for Story 11.5
- Workspace names in user detail link to `/admin/workspaces/${workspace.id}` for cross-navigation
- Manual testing deferred to user (search, paginate, click-through, empty states, relative time formatting)

## Change Log

| Date       | Version | Description                                                                                                                                                                                                                                         | Author      |
| ---------- | ------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------- |
| 2026-02-02 | 1.0     | Initial story creation                                                                                                                                                                                                                              | Sarah (PO)  |
| 2026-02-03 | 1.1     | SM enrichment: Fixed Prisma relation name (workspaces→workspace_members), fixed joined_at field, added Previous Story Insights from 11.1/11.3, corrected ROLE_LABELS to import from shared constants, added sort field allowlist, added source refs | Bob (SM)    |
| 2026-02-03 | 1.2     | PO validation: GO — AC4 partial coverage acknowledged (Workspace Count not sortable, accepted limitation), no critical issues, all anti-hallucination checks passed, status set to Approved                                                         | Sarah (PO)  |
| 2026-02-03 | 1.3     | Dev implementation: All 5 tasks completed, 6 new unit tests (20/20 pass), zero lint errors, status set to Ready for Review                                                                                                                          | James (Dev) |

## QA Results

### Review Date: 2026-02-03

### Reviewed By: Quinn (Test Architect)

### Risk Assessment

- Auth/payment/security files touched: No
- Tests added: Yes (6 unit tests)
- Diff size: ~400 lines (moderate, below deep-review threshold)
- Previous gate: N/A (first review)
- AC count: 8 (slightly elevated, but mitigated by read-only scope)
- **Verdict: Standard review depth**

### Code Quality Assessment

Implementation is clean and follows established patterns from Story 11.3 closely. The query layer uses `Promise.all` for parallel data fetching, `select` for field projection, and sort-field allowlists for safety. The client component mirrors the workspace-table pattern with TanStack Table, debounced search, URL-param-driven state, and proper Swedish localization. All shared constants imported from `lib/admin/constants.ts` — no local redefinitions.

Two minor issues found and addressed during review (see Refactoring Performed).

### Requirements Traceability

| AC  | Description                                                    | Validation                                                                                                                                  | Status |
| --- | -------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------- | ------ |
| 1   | User list page at `/admin/users`                               | `app/admin/(dashboard)/users/page.tsx` exists, renders UserTable                                                                            | PASS   |
| 2   | Searchable data table with 5 columns                           | `user-table.tsx` columns: Name, Email, Last Login, Workspace Count, Created Date                                                            | PASS   |
| 3   | Search by name/email (server-side)                             | `getUserList` builds OR clause on name/email with `contains` insensitive; test confirms                                                     | PASS   |
| 4   | Sortable by any column (server-side)                           | Sort on name, email, last_login_at, created_at via allowlist; Workspace Count not sortable (accepted limitation per PO v1.2)                | PASS   |
| 5   | Paginated (25/page, server-side)                               | `pageSize=25`, `skip/take` with `Promise.all`; test confirms pagination math                                                                | PASS   |
| 6   | Click row → detail view                                        | `router.push(/admin/users/${id})` on row click; back link on detail page                                                                    | PASS   |
| 7   | Detail view: user info + memberships + impersonate placeholder | Info card with name/email/avatar/created/last-login; workspace memberships table with role/tier/status/joined; disabled button with tooltip | PASS   |
| 8   | Read-only                                                      | No server actions, no mutations, no forms that submit                                                                                       | PASS   |

### Refactoring Performed

- **File**: `components/admin/user-table.tsx`
  - **Change**: Replaced `date.toLocaleDateString('sv-SE')` with `format(date, 'yyyy-MM-dd', { locale: sv })` for created_at column
  - **Why**: Pattern consistency — workspace-table.tsx uses date-fns `format()` for the same column. Both produce identical output but using the same library avoids mixed formatting approaches.
  - **How**: Added `format` to existing date-fns import; replaced cell renderer to match workspace-table pattern.

- **File**: `lib/admin/queries.ts`
  - **Change**: Reorganized file so `WorkspaceDetail` interface and `getWorkspaceDetail` function are adjacent (removed 130-line gap and duplicate section header)
  - **Why**: Dev insertion placed User List and User Detail sections between the Workspace Detail interface and its function, creating a confusing split with a duplicate "Workspace Detail (Story 11.3)" section header. User sections now follow after Workspace Detail.
  - **How**: Moved User List and User Detail sections to end of file, after `getWorkspaceDetail`. Removed duplicate section header. File order is now: Types → Queries → Workspace List → Workspace Detail → User List → User Detail.

### Compliance Check

- Coding Standards: ✓ Server-side data fetching, Prisma select, Promise.all, sort allowlist, Swedish UI text
- Project Structure: ✓ Files in correct directories matching established admin pattern
- Testing Strategy: ✓ 6 unit tests covering queries; component tests not required (consistent with project approach)
- All ACs Met: ✓ All 8 acceptance criteria verified

### Improvements Checklist

- [x] Fixed date formatting inconsistency in user-table.tsx (toLocaleDateString → date-fns format)
- [x] Reorganized queries.ts file structure (removed split between WorkspaceDetail interface and function)
- [ ] Consider extracting `useUpdateSearchParams` hook and `SortableHeader` component to shared `components/admin/table-utils.tsx` when a 3rd admin table is added (currently acceptable duplication per story notes)
- [ ] Consider adding a test for valid sort field (e.g., `name` ascending) — currently only invalid sort fallback is tested

### Security Review

No security concerns. Read-only story with no mutations. Sort field allowlist prevents orderBy injection. Admin routes are protected at layout level (Story 11.1). All data comes through Prisma with parameterized queries.

### Performance Considerations

No performance concerns. `Promise.all` for parallel queries, `select` for field projection, server-side pagination (25/page), no N+1 queries.

### Files Modified During Review

- `components/admin/user-table.tsx` — date formatting fix (1 import + 3 lines changed)
- `lib/admin/queries.ts` — file reorganization (moved sections, no logic changes)

Dev should update File List to note these QA modifications.

### Gate Status

Gate: **PASS** → docs/qa/gates/11.4-user-management.yml

### Recommended Status

✓ Ready for Done (pending manual testing: search, pagination, row click, empty states, relative time formatting)
