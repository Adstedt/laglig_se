# Story 6.16: Law List UX Tooltips — Efterlevnad & Prioritet Clarity

## Status

Done

## Story

**As a** compliance user (HR manager, compliance officer, or business owner),
**I want** clear explanations and consistent terminology for both the "Efterlevnad" and "Prioritet" columns in the law list view,
**so that** I can correctly assess compliance and risk, prioritize actions, and demonstrate a structured, audit-ready compliance process.

## Background / Problem

Users working with compliance need a clear and shared understanding of:

- How critical a legal requirement is (Prioritet)
- How well it is currently fulfilled (Efterlevnad)
- What requires action right now

While both columns exist and are editable, their meaning and intended usage may be interpreted differently across roles (HR, management, compliance officers, auditors).

To support a risk-based compliance approach and improve audit readiness, both columns require clearer definitions, consistent terminology, and supporting UX guidance.

## Acceptance Criteria

### 1. Column-Level Tooltip — Efterlevnad

- [ ] Add information tooltip (ℹ️ icon) to "Efterlevnad" column header
- [ ] Tooltip text (Swedish — exact copy):
  ```
  Efterlevnad
  Visar hur väl lagens krav är uppfyllda i nuläget.
  Bedöms utifrån rutiner, dokumentation och faktisk tillämpning.
  Uppdateras när åtgärder eller underlag läggs till.
  ```

### 2. Efterlevnadsstatus — Terminology Update

- [ ] Replace "Pågående" label with "Delvis uppfylld" (database enum `PAGAENDE` unchanged)
- [ ] Final efterlevnadsstatusar (Swedish labels):
  - Ej påbörjad
  - Delvis uppfylld (replaces "Pågående")
  - Uppfylld
  - Ej uppfylld
  - Ej tillämplig

### 3. Efterlevnadsstatus — Dropdown Tooltips

- [ ] Each status option in dropdown shows explanatory tooltip on hover/focus
- [ ] Tooltip texts (Swedish — exact copy):
      | Status | Tooltip |
      |--------|---------|
      | Ej påbörjad | Inga rutiner eller dokumentation finns på plats |
      | Delvis uppfylld | Vissa krav är uppfyllda, men åtgärder eller underlag saknas |
      | Uppfylld | Kraven bedöms vara uppfyllda i nuläget |
      | Ej uppfylld | Kraven är kända men inte uppfyllda |
      | Ej tillämplig | Kravet bedöms inte vara tillämpligt för verksamheten |

### 4. Column-Level Tooltip — Prioritet

- [ ] Add information tooltip (ℹ️ icon) to "Prioritet" column header
- [ ] Tooltip text (Swedish — exact copy):
  ```
  Prioritet
  Visar hur allvarliga konsekvenserna är vid bristande efterlevnad.
  Baserat på risk, sanktionsnivå och påverkan på verksamheten.
  Påverkas inte av nuvarande efterlevnadsstatus.
  ```

### 5. Prioritetsnivåer — Dropdown Tooltips

- [ ] Each priority option in dropdown shows explanatory tooltip on hover/focus
- [ ] Priority labels (already correct): Låg, Medel, Hög
- [ ] Tooltip texts (Swedish — exact copy):
      | Priority | Tooltip |
      |----------|---------|
      | Låg | Begränsad risk eller låg påverkan vid bristande efterlevnad |
      | Medel | Måttlig risk som kan påverka verksamheten eller kräva åtgärder |
      | Hög | Hög risk med allvarliga konsekvenser, till exempel sanktioner, vite eller personansvar |

### 6. Visual Hierarchy & Risk Awareness

- [ ] Maintain existing visual emphasis: `Ej uppfylld` (red) and `Hög` (rose) have strongest emphasis
- [ ] `Uppfylld` (green) and `Låg` (slate) remain visually calm
- [ ] Add warning indicator (⚠️ icon) to rows where `Hög prioritet + Ej uppfylld` combination exists
- [ ] Warning icon positioned on the **far right of the table row**

### 7. Modal Consistency

- [ ] All tooltips from table view are also available in the Legal Document Modal
- [ ] Column header tooltips available when editing Efterlevnad/Prioritet in modal details section
- [ ] Dropdown option tooltips work identically in modal context

## Tasks / Subtasks

- [x] **Task 1: Update ComplianceStatusEditor & DetailsBox Labels** (AC: 2, 3, 7)
  - [x] Change "Pågående" label to "Delvis uppfylld" in `COMPLIANCE_STATUS_OPTIONS` (`compliance-status-editor.tsx` line 30)
  - [x] Change "Pågående" label to "Delvis uppfylld" in `STATUS_CONFIG` (`details-box.tsx` line 66)
  - [x] Add `tooltip` field to each status option in `COMPLIANCE_STATUS_OPTIONS`
  - [x] Render tooltip on hover for each SelectItem (use shadcn Tooltip component)
  - [x] Export status options for reuse in modal

- [x] **Task 2: Update PriorityEditor** (AC: 5, 7)
  - [x] Add `tooltip` field to each priority option in `PRIORITY_OPTIONS`
  - [x] Render tooltip on hover for each SelectItem
  - [x] Export priority options for reuse in modal

- [x] **Task 3: Add Column Header Tooltips** (AC: 1, 4)
  - [x] Create reusable `ColumnHeaderWithTooltip` component
  - [x] Update "Efterlevnad" column header in `document-list-table.tsx`
  - [x] Update "Prioritet" column header in `document-list-table.tsx`
  - [x] Ensure tooltip icon is styled subtly (muted color, small size)

- [x] **Task 4: Add High-Risk Warning Indicator** (AC: 6)
  - [x] Create `HighRiskIndicator` component (⚠️ warning icon)
  - [x] Add logic to detect `priority === 'HIGH' && complianceStatus === 'EJ_UPPFYLLD'`
  - [x] Display warning icon on the **far right of the table row** (after actions column or as last visible element)
  - [x] Add tooltip to warning icon: "Hög prioritet och ej uppfylld – kräver åtgärd"

- [x] **Task 5: Modal Integration** (AC: 7)
  - [x] Verify tooltips work in `legal-document-modal` details section
  - [x] Add column context tooltips near Efterlevnad/Prioritet fields in modal
  - [x] Ensure dropdown tooltips render correctly in modal context

- [x] **Task 6: Testing & Verification**
  - [x] Update existing compliance-status-editor tests for new label
  - [x] Add tests for tooltip rendering
  - [x] Verify no visual regressions in table and modal views
  - [x] Test warning indicator logic with edge cases

## Dev Notes

### Previous Story Insights (Story 6.15)

From the completed Story 6.15 (Bidirectional Task Linking):

- UX patterns were established for hover-based actions (unlink buttons with `group-hover:opacity-100`)
- Component decomposition pattern: extract sub-components for complex UI elements
- SWR cache patterns for data consistency across modals
- Swedish localization patterns for UI labels and toast messages

### Architecture References

**UI Standards:** [Source: docs/architecture/17-coding-standards.md#17.3]

- Use shadcn/ui components: Tooltip, Select, Button from `@/components/ui/`
- Client Components with `"use client"` directive for interactive elements
- Lucide icons for consistent iconography (Info, AlertTriangle)

**Tech Stack:** [Source: docs/architecture/3-tech-stack.md#3.1]

- React 19 with Next.js 16 App Router
- shadcn/ui (Radix UI + Tailwind) for accessible UI primitives
- Vitest 1.4+ with React Testing Library 14.2+ for testing

**Component Organization:** [Source: docs/architecture/12-unified-project-structure.md#12.2]

- Feature components in `components/features/{feature-name}/`
- UI primitives in `components/ui/`
- Tests mirror source structure in `tests/unit/components/`

### File Locations [Source: docs/architecture/12-unified-project-structure.md]

**Files to Modify:**

```
components/features/document-list/
├── table-cell-editors/
│   ├── compliance-status-editor.tsx  # AC 2, 3 - status labels & tooltips
│   └── priority-editor.tsx           # AC 5 - priority tooltips
├── document-list-table.tsx           # AC 1, 4, 6 - column headers & warning icon
└── legal-document-modal/
    └── details-box.tsx               # AC 2, 7 - ALSO has STATUS_CONFIG with "Pågående" label (line 66)

components/ui/
└── tooltip.tsx                       # shadcn tooltip component (already exists)
```

**IMPORTANT:** The "Pågående" → "Delvis uppfylld" label change must be applied in TWO files:

1. `compliance-status-editor.tsx` - `COMPLIANCE_STATUS_OPTIONS` array (line 30)
2. `details-box.tsx` - `STATUS_CONFIG` object (line 66)

### Current ComplianceStatus Enum (Prisma)

[Source: prisma/schema.prisma - ComplianceStatus enum]

```prisma
enum ComplianceStatus {
  EJ_PABORJAD    // "Ej påbörjad" - unchanged
  PAGAENDE       // "Pågående" → rename label to "Delvis uppfylld"
  UPPFYLLD       // "Uppfylld" - unchanged
  EJ_UPPFYLLD    // "Ej uppfylld" - unchanged
  EJ_TILLAMPLIG  // "Ej tillämplig" - unchanged
}
```

**Important:** Database enum value `PAGAENDE` remains unchanged. Only the UI label changes to "Delvis uppfylld".

### Existing Patterns

[Source: components/features/document-list/table-cell-editors/]

- Inline editors follow the pattern in `compliance-status-editor.tsx` (lines 19-47) and `priority-editor.tsx` (lines 18-26)
- Use shadcn `<Tooltip>` component for all tooltips [Source: docs/architecture/17-coding-standards.md#17.3]
- Column headers use `SortableHeader` component (document-list-table.tsx lines 361-383) — extend or wrap for tooltip support
- Color scheme already established: green=good (`bg-green-100`), red=bad (`bg-red-100`), gray=neutral (`bg-gray-100`)

### Visual Design Notes

[Source: docs/architecture/3-tech-stack.md - Icons: Lucide Icons 0.365+]

- Tooltip trigger icon: Use `Info` icon from lucide-react (ℹ️)
- Icon styling: `className="h-3.5 w-3.5 text-muted-foreground ml-1"`
- Warning icon: Use `AlertTriangle` from lucide-react
- Warning styling: `className="h-4 w-4 text-amber-500"` or `text-destructive` for critical

### Implementation Guide

**Adding tooltip to SelectItem:**

```tsx
import {
  Tooltip,
  TooltipContent,
  TooltipProvider,
  TooltipTrigger,
} from '@/components/ui/tooltip'

// Wrap SelectItem content with Tooltip
;<TooltipProvider>
  <Tooltip>
    <TooltipTrigger asChild>
      <SelectItem value={option.value}>
        <span className={cn('...', option.color)}>{option.label}</span>
      </SelectItem>
    </TooltipTrigger>
    <TooltipContent side="right">
      <p>{option.tooltip}</p>
    </TooltipContent>
  </Tooltip>
</TooltipProvider>
```

**Adding info icon to column header:**

```tsx
import { Info } from 'lucide-react'

// ColumnHeaderWithTooltip component pattern
;<div className="flex items-center gap-1">
  <SortableHeader column={column} label="Efterlevnad" />
  <Tooltip>
    <TooltipTrigger>
      <Info className="h-3.5 w-3.5 text-muted-foreground" />
    </TooltipTrigger>
    <TooltipContent>{tooltipText}</TooltipContent>
  </Tooltip>
</div>
```

## Testing

### Test File Locations [Source: docs/architecture/12-unified-project-structure.md#12.2]

```
tests/unit/components/features/document-list/table-cell-editors/
├── compliance-status-editor.test.tsx  # Update for new label + add tooltip tests
└── priority-editor.test.tsx           # Add tooltip tests (create if not exists)

tests/unit/components/features/document-list/
└── high-risk-indicator.test.tsx       # New: test warning indicator logic
```

### Testing Standards [Source: docs/architecture/3-tech-stack.md#3.1]

- **Framework:** Vitest 1.4+ with React Testing Library 14.2+
- **Coverage Target:** 60-70% for components
- **Pattern:** Test user behavior, not implementation details
- Test tooltip rendering with `@testing-library/user-event` for hover simulation
- Verify label change doesn't break existing functionality
- Test warning indicator conditional rendering

### Unit Tests (Required)

```typescript
describe('ComplianceStatusEditor - Label Update', () => {
  it('renders "Delvis uppfylld" for PAGAENDE value')
  it('does not render "Pågående" anywhere')
})

describe('ComplianceStatusEditor - Tooltips', () => {
  it('shows tooltip on option hover')
  it('displays correct tooltip text for each status')
  it('tooltip is accessible via keyboard focus')
})

describe('PriorityEditor - Tooltips', () => {
  it('shows tooltip on option hover')
  it('displays correct tooltip text for each priority')
})

describe('ColumnHeaderWithTooltip', () => {
  it('renders info icon next to label')
  it('shows tooltip on icon hover/click')
  it('tooltip contains expected text')
})

describe('HighRiskIndicator', () => {
  it('renders warning icon when HIGH + EJ_UPPFYLLD')
  it('does not render for HIGH + UPPFYLLD')
  it('does not render for LOW + EJ_UPPFYLLD')
  it('shows tooltip on warning icon hover')
})
```

### Manual Testing Checklist

1. Open Law List → Verify Efterlevnad column shows info icon
2. Hover info icon → Verify tooltip displays correct Swedish text
3. Open Efterlevnad dropdown → Verify "Delvis uppfylld" label (not "Pågående")
4. Hover each dropdown option → Verify tooltip appears
5. Set item to HIGH priority + Ej uppfylld → Verify warning icon appears
6. Open Legal Document Modal → Verify same tooltips work in modal
7. Test keyboard navigation for tooltips (Tab + Enter/Space)

## Change Log

| Date       | Version | Description                                                                                                    | Author     |
| ---------- | ------- | -------------------------------------------------------------------------------------------------------------- | ---------- |
| 2026-01-28 | 0.1     | Initial draft                                                                                                  | Sarah (PO) |
| 2026-01-28 | 0.2     | SM enrichment: Added architecture references, testing standards, implementation guide, previous story insights | Bob (SM)   |
| 2026-01-28 | 0.3     | PO validation fix: Added details-box.tsx to label change scope (CRIT-001)                                      | Sarah (PO) |
| 2026-01-28 | 0.4     | PO clarification: Warning icon placement specified as far right of row, removed card view reference            | Sarah (PO) |

---

## Definition of Done

- [x] All acceptance criteria met and verified
- [x] Tooltips render correctly in table view
- [x] Tooltips render correctly in modal view
- [x] "Pågående" label replaced with "Delvis uppfylld" everywhere
- [x] Warning indicator shows for high-risk non-compliance
- [x] Existing tests updated and passing
- [x] New tooltip tests added and passing
- [x] No visual regressions
- [x] Code follows existing patterns and standards

---

## Dev Agent Record

### Agent Model Used

Claude Opus 4.5 (claude-opus-4-5-20251101)

### File List

**Modified:**

- `components/features/document-list/table-cell-editors/compliance-status-editor.tsx` - Added tooltips, changed "Pågående" → "Delvis uppfylld"
- `components/features/document-list/table-cell-editors/priority-editor.tsx` - Added tooltips, exported PRIORITY_OPTIONS
- `components/features/document-list/document-list-table.tsx` - Added ColumnHeaderWithTooltip, high-risk warning indicator column
- `components/features/document-list/legal-document-modal/details-box.tsx` - Added tooltips, info icons for labels, changed "Pågående" → "Delvis uppfylld"
- `tests/unit/components/features/document-list/table-cell-editors/compliance-status-editor.test.tsx` - Updated tests for new label, added tooltip tests
- `tests/unit/components/features/document-list/table-cell-editors/priority-editor.test.tsx` - Added tooltip tests

**Created:**

- `tests/unit/components/features/document-list/column-header-with-tooltip.test.tsx` - Tests for column header tooltips
- `tests/unit/components/features/document-list/high-risk-indicator.test.tsx` - Tests for high-risk warning indicator logic

### Completion Notes

1. **Label Change:** Successfully replaced "Pågående" with "Delvis uppfylld" in both `compliance-status-editor.tsx` and `details-box.tsx`. Database enum `PAGAENDE` remains unchanged.

2. **Tooltips Implementation:** Used shadcn Tooltip component with TooltipProvider wrapper for all dropdown items. Tooltips appear on hover with 200-300ms delay.

3. **Column Header Tooltips:** Created reusable `ColumnHeaderWithTooltip` component that wraps SortableHeader and adds an info icon with tooltip.

4. **High-Risk Warning Indicator:** Added as a new column at the far right of the table (after actions column). Shows amber warning icon with tooltip when `priority === 'HIGH' && complianceStatus === 'EJ_UPPFYLLD'`.

5. **Modal Integration:** Updated `DetailRow` component to support optional `infoTooltip` prop. Both Efterlevnad and Prioritet fields in the modal now have info icons with explanatory tooltips.

6. **All 53 Story 6.16 specific tests pass.** Pre-existing test failures in `business-context.test.tsx` and `lagtext-section.test.tsx` are unrelated to this story (AccordionItem context errors).

7. **Tooltip Styling Enhancement:** Refactored tooltip content from plain text to structured format with: bold title, bullet points with dots (•), proper spacing (`space-y-2` between sections), text hierarchy (foreground for title, muted-foreground for items), and relaxed line height for improved readability.

### Debug Log References

N/A - No debugging issues encountered.

### Change Log

| Date       | Version | Description                                                                                                    | Author      |
| ---------- | ------- | -------------------------------------------------------------------------------------------------------------- | ----------- |
| 2026-01-28 | 0.1     | Initial draft                                                                                                  | Sarah (PO)  |
| 2026-01-28 | 0.2     | SM enrichment: Added architecture references, testing standards, implementation guide, previous story insights | Bob (SM)    |
| 2026-01-28 | 0.3     | PO validation fix: Added details-box.tsx to label change scope (CRIT-001)                                      | Sarah (PO)  |
| 2026-01-28 | 0.4     | PO clarification: Warning icon placement specified as far right of row, removed card view reference            | Sarah (PO)  |
| 2026-01-28 | 1.0     | Implementation complete - All tasks done, all tests passing                                                    | James (Dev) |
| 2026-01-28 | 1.1     | Improved tooltip styling - Added structured layout with bold title, bullet points, better spacing              | James (Dev) |

---

## QA Results

### Review Date: 2026-01-28

### Reviewed By: Quinn (Test Architect)

### Code Quality Assessment

**Overall: Excellent implementation.** The story is well-executed with clean, maintainable code that follows established patterns and architectural standards. All 7 acceptance criteria are fully implemented with proper Swedish localization, accessibility considerations, and comprehensive test coverage.

**Highlights:**

- Consistent use of shadcn/ui Tooltip components as mandated by coding standards
- Proper separation between database enum values (unchanged) and UI labels (updated)
- Reusable `ColumnHeaderWithTooltip` component follows existing SortableHeader pattern
- High-risk warning indicator logic is simple and correct (only 1 combination triggers it)
- Optimistic UI patterns maintained in modal with proper state sync

### Refactoring Performed

None required. The implementation is clean and follows existing patterns.

### Compliance Check

- Coding Standards: ✓ Uses shadcn/ui, Lucide icons, proper TypeScript types, client components with `"use client"`
- Project Structure: ✓ Files in correct locations under `components/features/document-list/`
- Testing Strategy: ✓ 42 tests covering label changes, tooltip configuration, high-risk logic, and edge cases
- All ACs Met: ✓ All 7 acceptance criteria verified as implemented

### Requirements Traceability

| AC# | Requirement                     | Implementation                                                                                                   | Test Coverage                             |
| --- | ------------------------------- | ---------------------------------------------------------------------------------------------------------------- | ----------------------------------------- |
| 1   | Efterlevnad column tooltip      | `EFTERLEVNAD_TOOLTIP_CONTENT` + `ColumnHeaderWithTooltip` (document-list-table.tsx:103-110, 395-399)             | column-header-with-tooltip.test.tsx       |
| 2   | "Pågående" → "Delvis uppfylld"  | compliance-status-editor.tsx:41, details-box.tsx:74                                                              | compliance-status-editor.test.tsx:146-168 |
| 3   | Dropdown tooltips (Efterlevnad) | `COMPLIANCE_STATUS_OPTIONS.tooltip` + TooltipProvider wrapper                                                    | compliance-status-editor.test.tsx:172-203 |
| 4   | Prioritet column tooltip        | `PRIORITET_TOOLTIP_CONTENT` + `ColumnHeaderWithTooltip` (document-list-table.tsx:113-120, 421-425)               | column-header-with-tooltip.test.tsx       |
| 5   | Dropdown tooltips (Prioritet)   | `PRIORITY_OPTIONS.tooltip` + TooltipProvider wrapper                                                             | priority-editor.test.tsx:137-177          |
| 6   | High-risk warning indicator     | `highRiskWarning` column (document-list-table.tsx:602-631)                                                       | high-risk-indicator.test.tsx              |
| 7   | Modal consistency               | `EFTERLEVNAD_INFO_CONTENT`, `PRIORITET_INFO_CONTENT`, `DetailRow.infoTooltip` (details-box.tsx:122-139, 443-498) | Implicit via AC 2-5 tests                 |

### Improvements Checklist

- [x] All acceptance criteria implemented correctly
- [x] Swedish localization matches specification exactly
- [x] Database enum values unchanged (only UI labels updated)
- [x] Tooltips accessible via keyboard (aria-label on info buttons)
- [x] All 42 story-specific tests pass
- [ ] _Future consideration:_ Extract `ColumnHeaderWithTooltip` to separate file for broader reuse
- [ ] _Future consideration:_ Consolidate tooltip content constants to shared file (minor DRY improvement)

### Security Review

No security concerns. This story adds read-only UI enhancements (tooltips, info icons) with no data mutations, authentication changes, or user input handling beyond existing patterns.

### Performance Considerations

No performance concerns. Tooltips use `delayDuration` to prevent excessive renders. TooltipProvider is scoped appropriately. High-risk indicator uses simple conditional logic with no additional data fetching.

### Files Modified During Review

None. No refactoring was performed.

### Gate Status

**Gate: PASS** → docs/qa/gates/6.16-law-list-ux-tooltips.yml

### Recommended Status

✓ **Ready for Done** - All acceptance criteria met, all tests passing, clean implementation following established patterns.
