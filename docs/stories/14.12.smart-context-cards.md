# Story 14.12: Smart Context Cards

**Status:** Draft
**Epic:** 14 — Compliance Agent
**Dependencies:** 14.7 (Agent Tools), 14.8 (RAG Pipeline)

---

## Background

Story 14.11 introduced static context cards that display summary numbers and fire a text prompt on click. This story evolves them into intelligent, tool-backed components that deliver actionable insights at-a-glance.

---

## Tier 2: Tool-Backed Card Responses

Each card click triggers agent tools that return structured, actionable output instead of a generic text prompt.

### Efterlevnad (Compliance)
- Agent tool returns a structured compliance table: law name, status, last reviewed, gap summary
- Grouped by status (non-compliant first, then partial, then compliant)
- Clickable rows navigate to the document reader with the relevant section highlighted

### Ändringar (Changes)
- Agent tool returns a change timeline: date, law, change type, impact summary
- Sorted by recency, with unacknowledged changes highlighted
- "Acknowledge all" bulk action

### Förfallna (Overdue)
- Agent tool returns an overdue task list: task, due date, assigned law, owner
- Sortable by days overdue
- Quick-assign and snooze actions inline

### Denna vecka (This Week)
- Agent tool returns a weekly checklist: task, priority, estimated effort
- Progress tracking (done/total)
- "Mark done" inline action

### Implementation Notes
- Each card defines a `toolName` in its config that maps to an agent tool
- The chat response renderer detects structured tool output and renders a rich card instead of plain text
- Falls back to text prompt if the tool call fails

---

## Tier 3: Proactive Insight Cards

Dynamic cards generated server-side based on what matters today. Instead of 4 fixed cards, the dashboard shows the most relevant 3-5 cards from a pool.

### Possible Insight Cards
- **Nya lagändringar** — "3 new changes detected since last login" (triggers when unacknowledged changes exist)
- **Compliance drop** — "Compliance dropped from 82% to 71% this week" (triggers on significant change)
- **Unassigned laws** — "5 laws in your list have no responsible person" (triggers on gap detection)
- **Review reminders** — "3 documents haven't been reviewed in 90+ days"
- **Upcoming deadlines** — "2 compliance deadlines within 7 days"

### Architecture
- Server-side insight generator runs on page load (or via cron-cached data)
- Each insight type has a priority score and relevance check
- Top N insights rendered as cards, rest available in an expandable section
- Cards support dismiss/snooze per user

---

## Open Questions
- How many proactive cards should show before it becomes overwhelming? (3-5 proposed)
- Should Tier 3 cards replace or supplement the fixed Tier 1 cards?
- Do we need a "card dismissed" persistence model?

---

## Acceptance Criteria (TBD)
- To be defined after Stories 14.7 and 14.8 are complete
- Needs design review for card layouts and interaction patterns
