# Story 6.6: Implement Task Modal (Jira-Style)

## Status

Draft

## Story

**As a** user,
**I want** to click a task to see full details,
**so that** I can manage task execution and collaboration.

## Acceptance Criteria

1. Clicking task opens large modal (80% viewport width, 90% height - SAME as Legal Document Modal)
2. Breadcrumb: "Uppgifter / [Task Title]"
3. Close button (X) + ESC key closes modal

**Left Panel (Scrollable - 60% width):**

4. **Task Title:** Large, editable inline on click
5. **Status + Priority Badges:** Visual indicators below title
6. **Beskrivning:** Rich text editor (markdown), auto-saves on blur
7. **Aktivitet Section with Tabs:**
   - **Alla:** Combined feed of comments and history
   - **Kommentarer:** Threaded comments only
   - **Historik:** Change log only
8. **Comment Input Box (always visible at top of Aktivitet):**
   - Avatar + "Lagg till en kommentar..." placeholder
   - Quick action buttons: "Suggest a reply...", "Status update...", "Thanks..."

**Comments (Jira-style threaded):**

9. Threaded replies with nesting
10. User avatar + name + timestamp
11. Markdown supported in comments
12. Edit/delete own comments (with "Redigerad" indicator)
13. "Svara" button for threading
14. @mentions with autocomplete

**History:**

15. All changes: status, assignee, due date, description edits
16. Format: "Anna andrade status till Klar - 2025-01-07 14:32"

**Right Panel (Static/Fixed - 40% width):**

17. **Detaljer Box:**
    - Status dropdown (moves task between columns)
    - Ansvarig: User selector dropdown
    - Forfallodatum: Date picker (hard deadline)
    - Prioritet: Hog/Medium/Lag selector
    - Skapad: Date + creator name
18. **Lankade lagar Box:**
    - List of linked list items with category badges
    - Click -> Opens that Legal Document Modal
    - "+ Lagg till lank" -> Search and add more list items
19. **Bevis Box:**
    - Drag-and-drop zone
    - List of attached files with icons
    - Preview on hover for images
    - Upload to Supabase Storage
    - Accepted types: PDF, images, Office docs
    - Max file size: 25MB
20. **Etiketter Box:**
    - Tag input for custom labels
    - Click to add, X to remove

**Footer:**

21. Created date + creator (subtle text)
22. Last updated timestamp
23. "Radera uppgift" button (with confirmation modal)

## Tasks / Subtasks

_To be detailed during sprint planning_

- [ ] Create modal shell matching Legal Document Modal proportions
- [ ] Implement editable task title
- [ ] Build description rich text editor
- [ ] Create activity tabs (All, Comments, History)
- [ ] Implement comment input with quick actions
- [ ] Build threaded comments display
- [ ] Implement right panel detail boxes
- [ ] Add linked laws section
- [ ] Build evidence upload/display
- [ ] Add labels/tags functionality
- [ ] Implement delete with confirmation

## Dev Notes

**Design Reference:** Use SAME proportions as Legal Document Modal (Story 6.3) for UX consistency - users should "feel at home" switching between modals.

### Layout Wireframe

```
+-----------------------------------------------------------------------+
| [Breadcrumb: Uppgifter / Task Title]                   [X] Close       |
+---------------------------------------------+-------------------------+
|                                             |                         |
|  LEFT PANEL (60% width, SCROLLABLE)         |  RIGHT PANEL (40%)      |
|                                             |  STATIC (fixed)         |
|  [Task Title - editable]                    |  [Detaljer Box]         |
|  [Status Badge] [Priority Badge]            |  [Lankade lagar Box]    |
|                                             |  [Bevis Box]            |
|  [Beskrivning - rich text]                  |  [Etiketter Box]        |
|                                             |                         |
|  [Aktivitet]                                |                         |
|  [Alla] [Kommentarer] [Historik]            |                         |
|  [Comment input box]                        |                         |
|  [Threaded comments...]                     |                         |
|                                             |                         |
+---------------------------------------------+-------------------------+
```

### File Locations

```
components/features/tasks/
  task-modal/
    index.tsx
    left-panel.tsx
    right-panel.tsx
    task-title-editor.tsx
    description-editor.tsx
    activity-tabs.tsx
    comment-input.tsx
    threaded-comments.tsx
    linked-laws.tsx
    evidence-upload.tsx
    labels-input.tsx
```

## Testing

- Unit tests for each component
- E2E tests for modal interactions
- Test comment threading
- Test evidence upload

## Change Log

| Date       | Version | Description            | Author     |
| ---------- | ------- | ---------------------- | ---------- |
| 2026-01-08 | 1.0     | Initial story creation | Sarah (PO) |
