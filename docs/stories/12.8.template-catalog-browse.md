# Story 12.8: Template Catalog Browse Page

## Status

Draft

## Story

**As a** user or visitor,
**I want** to browse available law list templates by domain,
**so that** I can find a relevant starting point for my compliance work.

## Acceptance Criteria

1. Public route: `/laglistor` (or `/templates` — TBD based on SEO analysis)
2. Catalog page displays all PUBLISHED templates as cards: template name, domain badge, description excerpt, key stats (document count, section count), target audience tag, primary regulatory body icons/badges
3. Filter by domain or target audience
4. Tjänsteföretag variants shown as toggle on parent template card ("Visa tjänsteföretagsversion")
5. Each card links to template detail/preview page
6. SEO: Page is SSR, indexable, with structured data (schema.org)
7. Mobile-responsive card grid (1 col mobile, 2-3 col desktop)
8. Empty state for domains with no published templates ("Kommer snart")

## Tasks / Subtasks

- [ ] **Task 1: Create catalog route and page** (AC: 1, 6)
  - [ ] Create `app/(public)/laglistor/page.tsx` (Server Component for SSR)
  - [ ] Add Next.js metadata export for SEO (title, description, Open Graph)
  - [ ] Add structured data (schema.org CollectionPage or ItemList)
- [ ] **Task 2: Build catalog query** (AC: 2)
  - [ ] Create `lib/db/queries/template.ts`
  - [ ] Query: `LawListTemplate WHERE status = PUBLISHED AND is_variant = false`
  - [ ] Include variant children (for toggle display)
  - [ ] Select: name, slug, description, domain, target_audience, document_count, section_count, primary_regulatory_bodies
- [ ] **Task 3: Build template card component** (AC: 2, 5)
  - [ ] Create `components/features/templates/template-card.tsx`
  - [ ] Display: template name, domain badge, description excerpt (truncated), doc count, section count
  - [ ] Target audience tag
  - [ ] Regulatory body badges
  - [ ] Link to `/laglistor/{slug}`
- [ ] **Task 4: Implement variant toggle** (AC: 4)
  - [ ] On parent template cards that have variants: show toggle "Visa tjänsteföretagsversion"
  - [ ] Toggle updates the card to show variant stats (55 docs instead of 112)
  - [ ] Toggle links to variant's detail page (`/laglistor/arbetsmiljo-tjansteforetag`)
- [ ] **Task 5: Implement domain filter** (AC: 3)
  - [ ] Filter component: domain tags or dropdown
  - [ ] Client-side filtering (small catalog) or URL-param based
- [ ] **Task 6: Responsive layout** (AC: 7)
  - [ ] Card grid: `grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6`
  - [ ] Cards use shadcn/ui Card component
- [ ] **Task 7: Empty state** (AC: 8)
  - [ ] If no published templates exist for a domain, show "Kommer snart" card/message
  - [ ] If catalog is completely empty, show appropriate empty state
- [ ] **Task 8: Write tests** (AC: all)
  - [ ] Component test: template card renders all fields correctly
  - [ ] Component test: variant toggle shows/hides variant info
  - [ ] Component test: domain filter works
  - [ ] Component test: responsive grid layout
  - [ ] E2E test: catalog page loads with published templates

## Dev Notes

### Implementation Context (Decision B — FE First with Mock Data)

This story is built **before** templates are seeded. Use mock/stub template data during development and testing. The catalog page should handle empty states gracefully ("Kommer snart"). The blocking dependency on 12.4/12.5 is removed — build the page now with mock data, real published templates appear later.

**Revised dependency**: No longer blocked by 12.4/12.5. Blocked only by 12.2 (schema must exist).

### Route Structure

Public route under `app/(public)/laglistor/` — follows existing pattern for public pages (law browse is at `app/(public)/lagar/`).

### SSR Requirements

This page MUST be a Server Component for SEO. Fetch templates server-side. Use `Suspense` + `loading.tsx` for loading states.

### Existing Component Patterns

- **Card component:** `components/ui/card.tsx` (shadcn/ui)
- **Badge component:** `components/ui/badge.tsx` (shadcn/ui) — for domain, target audience
- **Responsive grid:** Use Tailwind grid classes

### Structured Data (schema.org)

```json
{
  "@context": "https://schema.org",
  "@type": "CollectionPage",
  "name": "Laglistmallar",
  "description": "Expertframtagna laglistor för svensk regelefterlevnad",
  "hasPart": [
    {
      "@type": "CreativeWork",
      "name": "Arbetsmiljö",
      "description": "..."
    }
  ]
}
```

### Variant Display Logic

For Phase 1 (3 templates), only Arbetsmiljö has a variant (Tjänsteföretag). The variant toggle appears on the parent card. When toggled, the card stats update to reflect the variant (55 docs, 7 sections).

### Dependencies

- **Blocked by:** Story 12.2 (schema must exist). Previously listed 12.4/12.5, but per Decision B these are deferred — build with mock data

### Relevant Source Tree

```
app/(public)/laglistor/page.tsx                    # New catalog page
app/(public)/laglistor/loading.tsx                 # Loading state
components/features/templates/template-card.tsx    # New card component
lib/db/queries/template.ts                         # New query file
```

### Testing

- **Test framework:** Vitest 1.4+ with React Testing Library
- **Test location:** `tests/unit/components/features/templates/`
- **Tests needed:**
  - Card renders template name, domain badge, stats
  - Variant toggle changes displayed stats
  - Domain filter hides/shows correct cards
  - Empty state renders when no templates
  - SSR: page renders server-side (no hydration errors)

## Change Log

| Date       | Version | Description            | Author     |
|------------|---------|------------------------|------------|
| 2026-02-06 | 1.0     | Initial story creation | Sarah (PO) |
| 2026-02-08 | 1.1     | Added mock data context, removed seeding dependency per Decision B | Sarah (PO) |

## Dev Agent Record

_To be populated by dev agent_

## QA Results

_To be populated by QA agent_
