# Story 6.3: Implement Legal Document Modal (Jira-Style Deep Workspace)

## Status

Draft

## Story

**As a** user,
**I want** to click a law in my list to open a detailed modal,
**so that** I can manage compliance for that specific law in context.

## Acceptance Criteria

1. Clicking list item opens large modal (80% viewport width, 90% height, Jira-style)
2. Modal is scoped to that specific list item (not the global legal document)
3. Breadcrumb showing: List name -> Law title
4. Close button (X) top-right + ESC key closes modal

**Left Panel (Scrollable - 60% width):**

5. **Law Header:** Title + SFS number + Category badge + Status dropdown
6. **Lagtext Section (Collapsible):**
   - Shows actual legal document content from the linked legal_document
   - Initial view: First 300px with gradient fade
   - "Visa mer" button expands to show full content
   - "Visa mindre" collapses back
7. **Affarskontextt (Business Context):**
   - Textarea: "Hur paverkar denna lag oss?"
   - Markdown supported, auto-saves on blur
8. **Aktivitet Section with Tabs:**
   - **Alla:** Combined feed of comments, task updates, evidence uploads, changes
   - **Kommentarer:** Threaded comments (Jira-style)
   - **Uppgifter:** Task list with status, click opens Task Modal
   - **Bevis:** Evidence grid/list with previews
   - **Historik:** Audit log of all changes

**Right Panel (Static/Fixed - 40% width):**

9. **Detaljer Box:**
   - Status dropdown (Ej paborjad, Pagaende, Uppfylld, Ej uppfylld, Ej tillamplig)
   - Ansvarig (Responsible person selector)
   - Created date, Last updated date
10. **Snabblankar Box:**
    - "Visa fullstandig lag" -> Opens law detail page in new tab
    - "Fraga AI om lagen" -> Opens AI chat with law context
11. **Uppgifter Summary Box:**
    - Task progress: "3/5 klara" with progress bar
    - List of tasks (max 5 shown) with status indicators
    - Click task -> Opens Task Modal (Story 6.6)
    - "+ Skapa uppgift" button
12. **Bevis Summary Box:**
    - File count: "4 filer"
    - Thumbnail grid of recent evidence
    - Click -> Scrolls to Evidence tab in left panel

**Mobile Behavior:**

13. Modal becomes full-screen on mobile
14. Two-panel layout collapses to single column
15. Tabs become horizontal scrollable pills

## Tasks / Subtasks

_To be detailed during sprint planning_

- [ ] Create modal shell component with two-panel layout
- [ ] Implement law header with status dropdown
- [ ] Build collapsible Lagtext section
- [ ] Create business context textarea with auto-save
- [ ] Build tabbed activity section
- [ ] Implement right panel detail boxes
- [ ] Add task summary with progress bar
- [ ] Add evidence summary grid
- [ ] Mobile responsive adaptations
- [ ] Keyboard navigation (ESC to close)

## Dev Notes

**Design Reference:** Mimic Jira's issue modal layout as closely as possible while maintaining Laglig's design language.

### Layout Wireframe

```
+-----------------------------------------------------------------------+
| [Breadcrumb: List Name / Law Title]                    [X] Close       |
+---------------------------------------------+-------------------------+
|                                             |                         |
|  LEFT PANEL (60% width, SCROLLABLE)         |  RIGHT PANEL (40%)      |
|                                             |  STATIC (fixed)         |
|  [Law Title + SFS Number]                   |  [Detaljer Box]         |
|  [Category Badge] [Status Dropdown]         |  [Snabblankar Box]      |
|                                             |  [Uppgifter Summary]    |
|  [Lagtext - Collapsible]                    |  [Bevis Summary]        |
|                                             |                         |
|  [Affarskontext Textarea]                   |                         |
|                                             |                         |
|  [Aktivitet Tabs]                           |                         |
|  [Alla] [Kommentarer] [Uppgifter] [Bevis]   |                         |
|                                             |                         |
+---------------------------------------------+-------------------------+
```

### File Locations

```
components/features/compliance/
  legal-document-modal/
    index.tsx
    left-panel.tsx
    right-panel.tsx
    lagtext-section.tsx
    business-context.tsx
    activity-tabs.tsx
```

## Testing

- Unit tests for each panel component
- E2E tests for modal open/close, tab navigation
- Mobile responsive tests
- Accessibility tests (focus trap, ESC key)

## Change Log

| Date       | Version | Description            | Author     |
| ---------- | ------- | ---------------------- | ---------- |
| 2026-01-08 | 1.0     | Initial story creation | Sarah (PO) |
