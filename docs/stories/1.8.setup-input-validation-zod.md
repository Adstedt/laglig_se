# Story 1.8: Set Up Input Validation (Zod Schemas)

## Status
Draft

## Story

**As a** developer,
**I want** to validate all user inputs server-side with type-safe schemas,
**so that** I prevent injection attacks and data corruption.

## Acceptance Criteria

1. Zod library installed
2. Validation schemas created for user signup/login
3. API routes validate request bodies using Zod
4. Example: POST `/api/auth/signup` validates email format, password complexity
5. Validation errors return clear messages
6. No raw user input passed to database queries
7. XSS prevention: React auto-escapes, no dangerouslySetInnerHTML

## Tasks / Subtasks

- [ ] Install Zod
  - [ ] Run: `npm install zod`

- [ ] Create validation schemas
  - [ ] Create `lib/validation/auth.ts`
  - [ ] SignupSchema (email, password, name)
  - [ ] LoginSchema (email, password)

- [ ] Apply validation to API routes
  - [ ] Validate signup endpoint
  - [ ] Validate login endpoint
  - [ ] Return validation errors as JSON

- [ ] Ensure XSS prevention
  - [ ] Audit code for `dangerouslySetInnerHTML`
  - [ ] Verify React auto-escaping working
  - [ ] Use DOMPurify if needed for user HTML content

## Dev Notes

### Zod Validation Schemas

**lib/validation/auth.ts:**
```typescript
import { z } from 'zod'

export const SignupSchema = z.object({
  email: z.string().email('Invalid email'),
  password: z
    .string()
    .min(8, 'Min 8 characters')
    .regex(/[A-Z]/, 'Need uppercase')
    .regex(/[a-z]/, 'Need lowercase')
    .regex(/[0-9]/, 'Need number'),
  name: z.string().min(2, 'Min 2 characters'),
})

export const LoginSchema = z.object({
  email: z.string().email(),
  password: z.string().min(1),
})
```

**Usage in API route:**
```typescript
export async function POST(request: Request) {
  const body = await request.json()
  const result = SignupSchema.safeParse(body)

  if (!result.success) {
    return NextResponse.json(
      { errors: result.error.flatten() },
      { status: 400 }
    )
  }

  // Proceed with validated data
  const { email, password, name } = result.data
}
```

**Reference:** Architecture Section 15.1 (Input Validation), Section 18 (Error Handling)

### Testing
**Test File:** `tests/unit/lib/validation.test.ts`

Test valid and invalid inputs for each schema.

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-11-11 | 1.0 | Initial story creation | Sarah (PO) |

## Dev Agent Record
_To be populated by dev agent_

## QA Results
_To be populated by QA agent_
