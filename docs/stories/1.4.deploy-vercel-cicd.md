# Story 1.4: Deploy to Vercel with CI/CD Pipeline

## Status
Draft

## Story

**As a** developer,
**I want** to automatically deploy to Vercel on every push to main,
**so that** I can continuously deliver features without manual deployment.

## Acceptance Criteria

1. Vercel project created and linked to GitHub
2. Automatic deployments for main branch (production)
3. Preview deployments for all PRs
4. Environment variables configured in Vercel
5. Build succeeds without errors
6. Production URL accessible
7. GitHub Actions workflow runs: ESLint, TypeScript, Prettier
8. Failed checks block PR merges

## Tasks / Subtasks

- [ ] Create and link Vercel project (AC: 1, 2, 3)
  - [ ] Sign up at vercel.com
  - [ ] Import GitHub repository
  - [ ] Configure automatic deployments
  - [ ] Test preview deployment with PR

- [ ] Configure environment variables in Vercel (AC: 4)
  - [ ] Add all `.env.local` variables to Vercel dashboard
  - [ ] Set production and preview environments separately
  - [ ] Verify build succeeds with env vars

- [ ] Set up GitHub Actions for CI (AC: 7, 8)
  - [ ] Create `.github/workflows/ci.yml`
  - [ ] Add lint, typecheck, format checks
  - [ ] Configure branch protection rules
  - [ ] Require status checks before merge

- [ ] Verify production deployment (AC: 5, 6)
  - [ ] Trigger deployment by pushing to main
  - [ ] Check build logs for errors
  - [ ] Test production URL
  - [ ] Verify all pages load correctly

## Dev Notes

### Vercel Configuration

**Project Settings:**
- Framework Preset: Next.js
- Build Command: `next build`
- Output Directory: `.next`
- Install Command: `npm install`
- Node Version: 20.x

**Deployment Branches:**
- **Production:** `main` branch → https://laglig-se.vercel.app
- **Preview:** All other branches → https://laglig-se-[branch].vercel.app

### GitHub Actions CI Workflow

**.github/workflows/ci.yml:**
```yaml
name: CI

on:
  pull_request:
    branches: [main, develop]
  push:
    branches: [main]

jobs:
  lint-and-typecheck:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Run ESLint
        run: npm run lint

      - name: Run TypeScript check
        run: npx tsc --noEmit

      - name: Run Prettier check
        run: npx prettier --check .

      - name: Run tests
        run: npm test
```

### Environment Variables for Vercel

```bash
# Production Environment
DATABASE_URL="[production connection string]"
DIRECT_URL="[production direct URL]"
NEXT_PUBLIC_SUPABASE_URL="[production supabase URL]"
NEXT_PUBLIC_SUPABASE_ANON_KEY="[production anon key]"
NEXTAUTH_SECRET="[production secret]"
NEXTAUTH_URL="https://laglig-se.vercel.app"
GOOGLE_CLIENT_ID="..."
GOOGLE_CLIENT_SECRET="..."
MICROSOFT_CLIENT_ID="..."
MICROSOFT_CLIENT_SECRET="..."

# Preview Environment (use same dev credentials)
[Same as production but with dev database]
```

### Branch Protection Rules

**GitHub → Settings → Branches → Branch protection rule:**
- Branch name pattern: `main`
- Require status checks: ✅ CI / lint-and-typecheck
- Require branches to be up to date: ✅
- Do not allow bypassing

### Important Architecture References

**From Section 14 (Deployment Architecture):**
- Vercel deployment configuration
- Environment-specific settings
- Zero-downtime deployment strategy

**From Section 19 (Monitoring):**
- Vercel Analytics for performance tracking
- Build failure alerts
- Deployment notifications

### Testing

**Verification Steps:**
1. Create PR → verify preview deployment
2. Check GitHub Actions passes
3. Merge to main → verify production deployment
4. Test production URL loads
5. Verify environment variables applied correctly

### User Responsibilities
- Create Vercel account
- Connect GitHub repository to Vercel
- Provide production environment credentials

### Developer Responsibilities
- Configure GitHub Actions workflow
- Set up branch protection
- Test deployment pipeline
- Document deployment process

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-11-11 | 1.0 | Initial story creation from PRD Epic 1 | Sarah (PO) |

## Dev Agent Record

### Agent Model Used
_To be populated by dev agent_

### Debug Log References
_To be populated by dev agent_

### Completion Notes List
_To be populated by dev agent_

### File List
_To be populated by dev agent_

## QA Results
_To be populated by QA agent_
