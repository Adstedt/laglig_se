# Story 1.5: Create Initial Law Pages (SSR for SEO) - 100 Laws

## Status

Draft

## Story

**As a** visitor,
**I want** to view Swedish laws on public pages optimized for Google,
**so that** I can discover Laglig.se through organic search.

## Acceptance Criteria

1. Riksdagen API integration fetches 100 SFS laws
2. Law data stored in `legal_documents` table
3. Dynamic route `/alla-lagar/[lawSlug]` renders law pages
4. Law pages use SSR for SEO
5. Each page includes: title, SFS number, full text, published date
6. Meta tags configured (title, description, Open Graph)
7. Sitemap.xml generated listing all 100 laws
8. Robots.txt allows all crawlers
9. Core Web Vitals meet "Good" thresholds
10. Pages render correctly on desktop and mobile

## Tasks / Subtasks

- [ ] Create Riksdagen API integration (AC: 1)
  - [ ] Create `lib/api/riksdagen.ts` with fetchLaws() function
  - [ ] Implement pagination to fetch 100 SFS laws
  - [ ] Parse XML/JSON response to structured data
  - [ ] Handle API errors gracefully

- [ ] Create Prisma schema for laws (AC: 2)
  - [ ] Add `LegalDocument` model to schema
  - [ ] Fields: id, contentType, documentNumber, title, fullText, slug, etc.
  - [ ] Run migration: `npx prisma migrate dev`
  - [ ] Create seed script to import 100 laws

- [ ] Create law detail page (AC: 3, 4, 5)
  - [ ] Create `app/alla-lagar/[lawSlug]/page.tsx`
  - [ ] Use `generateStaticParams` for static generation
  - [ ] Fetch law data with Prisma
  - [ ] Display: title, SFS number, full text, published date
  - [ ] Add breadcrumbs: Home → Alla lagar → [Law name]

- [ ] Add SEO meta tags (AC: 6)
  - [ ] Configure `generateMetadata` function
  - [ ] Title: "[Law name] - SFS [number] | Laglig.se"
  - [ ] Description: First 155 characters of law text
  - [ ] Open Graph tags for social sharing

- [ ] Generate sitemap.xml (AC: 7)
  - [ ] Create `app/sitemap.ts`
  - [ ] Include all 100 law URLs
  - [ ] Set priority: 0.7 for law pages
  - [ ] Update frequency: weekly

- [ ] Create robots.txt (AC: 8)
  - [ ] Create `app/robots.ts`
  - [ ] Allow all crawlers
  - [ ] Link to sitemap

- [ ] Optimize for Core Web Vitals (AC: 9)
  - [ ] Test LCP < 2.5s (optimize images, use next/image)
  - [ ] Test FID < 100ms (minimize JavaScript)
  - [ ] Test CLS < 0.1 (reserve space for dynamic content)

- [ ] Test responsive design (AC: 10)
  - [ ] Test on mobile (375px width)
  - [ ] Test on tablet (768px width)
  - [ ] Test on desktop (1920px width)

## Dev Notes

### Riksdagen API Integration

**API Endpoint:** `https://data.riksdagen.se/dokumentlista/?doktyp=sfs&sort=rel&sortorder=desc&utformat=json&p=1`

**lib/api/riksdagen.ts:**

```typescript
export async function fetchSFSLaws(limit: number = 100) {
  const laws = []
  let page = 1

  while (laws.length < limit) {
    const response = await fetch(
      `https://data.riksdagen.se/dokumentlista/?doktyp=sfs&utformat=json&p=${page}`
    )
    const data = await response.json()

    for (const doc of data.dokumentlista.dokument) {
      laws.push({
        documentNumber: doc.beteckning,
        title: doc.titel,
        publicationDate: doc.publicerad,
        sourceUrl: doc.dokument_url_html,
      })

      if (laws.length >= limit) break
    }

    page++
  }

  return laws
}
```

### Law Detail Page with SSR

**app/alla-lagar/[lawSlug]/page.tsx:**

```typescript
import { prisma } from '@/lib/prisma'
import { notFound } from 'next/navigation'

export async function generateStaticParams() {
  const laws = await prisma.legalDocument.findMany({
    where: { contentType: 'SFS_LAW' },
    select: { slug: true },
    take: 100,
  })

  return laws.map((law) => ({ lawSlug: law.slug }))
}

export async function generateMetadata({ params }: { params: { lawSlug: string } }) {
  const law = await prisma.legalDocument.findUnique({
    where: { slug: params.lawSlug },
  })

  if (!law) return {}

  return {
    title: `${law.title} - ${law.documentNumber} | Laglig.se`,
    description: law.summary?.substring(0, 155) || law.title,
    openGraph: {
      title: law.title,
      description: law.summary,
      type: 'article',
    },
  }
}

export default async function LawPage({ params }: { params: { lawSlug: string } }) {
  const law = await prisma.legalDocument.findUnique({
    where: { slug: params.lawSlug },
  })

  if (!law) notFound()

  return (
    <div className="max-w-4xl mx-auto p-6">
      <h1 className="text-3xl font-bold mb-2">{law.title}</h1>
      <p className="text-gray-600 mb-4">{law.documentNumber}</p>
      <div className="prose max-w-none">{law.fullText}</div>
    </div>
  )
}
```

### Sitemap Generation

**app/sitemap.ts:**

```typescript
import { prisma } from '@/lib/prisma'
import { MetadataRoute } from 'next'

export default async function sitemap(): Promise<MetadataRoute.Sitemap> {
  const laws = await prisma.legalDocument.findMany({
    where: { contentType: 'SFS_LAW' },
    select: { slug: true, updatedAt: true },
    take: 100,
  })

  return laws.map((law) => ({
    url: `https://laglig-se.vercel.app/alla-lagar/${law.slug}`,
    lastModified: law.updatedAt,
    changeFrequency: 'weekly',
    priority: 0.7,
  }))
}
```

### Important Architecture References

**From Section 2.2 (SEO Strategy):**

- SSR required for all public law pages
- Meta tags essential for organic traffic
- Core Web Vitals directly impact rankings

**From Section 10.4 (Routing):**

- Dynamic routes with `generateStaticParams`
- Static generation at build time for performance

**From External APIs docs:**

- Riksdagen API comprehensive guide
- Section 12 has production-ready code

### Testing

**Test File:** `tests/integration/pages/law-page.test.ts`

```typescript
import { test, expect } from '@playwright/test'

test('law page renders with SSR', async ({ page }) => {
  await page.goto('/alla-lagar/arbetsmiljolagen-1977-1160')

  // Check title rendered
  await expect(page.locator('h1')).toContainText('Arbetsmiljölagen')

  // Check meta tags
  const title = await page.title()
  expect(title).toContain('Arbetsmiljölagen')

  // Check full text visible
  await expect(page.locator('.prose')).toBeVisible()
})

test('sitemap.xml accessible', async ({ request }) => {
  const response = await request.get('/sitemap.xml')
  expect(response.status()).toBe(200)

  const text = await response.text()
  expect(text).toContain('alla-lagar')
})
```

### User Responsibilities

- None for this story

### Developer Responsibilities

- Integrate Riksdagen API
- Create law pages with SSR
- Optimize for SEO and performance
- Generate sitemap and robots.txt

## Change Log

| Date       | Version | Description                            | Author     |
| ---------- | ------- | -------------------------------------- | ---------- |
| 2025-11-11 | 1.0     | Initial story creation from PRD Epic 1 | Sarah (PO) |

## Dev Agent Record

### Agent Model Used

_To be populated by dev agent_

### Debug Log References

_To be populated by dev agent_

### Completion Notes List

_To be populated by dev agent_

### File List

_To be populated by dev agent_

## QA Results

_To be populated by QA agent_
