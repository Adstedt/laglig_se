# Story 2.7: Build Multi-Content-Type Search and Filtering

## Status

Draft

## Story

**As a** user,
**I want** to search across all legal content types with filtering,
**so that** I can quickly find specific laws, court precedent, or EU regulations.

## Acceptance Criteria

1. Unified search page created: `/sok`
2. Full-text search using PostgreSQL `tsvector` across all content types
3. Search queries match: titles, document numbers, full text, summaries
4. Mixed content type results with clear type badges
5. Each result shows: title, document number, content type, category, snippet
6. Weighted relevance ranking (Title: 1.0, Document number: 0.9, Full text: 0.5)
7. Filters: Content Type, Category, Business Type, Date Range
8. Search performance <800ms for 170,000+ documents
9. Pagination (20 results/page)
10. No results state with suggestions
11. Mobile-responsive interface
12. Search analytics tracked

## Tasks / Subtasks

- [ ] Create search page and API
  - [ ] Create `app/sok/page.tsx`
  - [ ] Create search API: `app/api/search/route.ts`
  - [ ] Implement PostgreSQL full-text search

- [ ] Implement weighted ranking
  - [ ] Configure ts_rank_cd for relevance
  - [ ] Weight: title (A), documentNumber (B), fullText (D)

- [ ] Add filter UI
  - [ ] Content type checkboxes
  - [ ] Category dropdown
  - [ ] Date range picker
  - [ ] Apply filters to query

- [ ] Optimize performance
  - [ ] Create GIN index on search_vector
  - [ ] Test with 170K documents
  - [ ] Ensure <800ms response time

- [ ] Implement pagination
  - [ ] 20 results per page
  - [ ] URL params for page number

- [ ] Add analytics tracking
  - [ ] Log search queries
  - [ ] Track result clicks
  - [ ] Store in analytics table

## Dev Notes

**Reference:** Architecture Section 2.3 (Search Strategy), Section 9 (Database indexes)
**Performance:** GIN index on tsvector, query optimization, caching

## Change Log

| Date       | Version | Description            | Author     |
| ---------- | ------- | ---------------------- | ---------- |
| 2025-11-11 | 1.0     | Initial story creation | Sarah (PO) |

## Dev Agent Record

_To be populated by dev agent_

## QA Results

_To be populated by QA agent_
