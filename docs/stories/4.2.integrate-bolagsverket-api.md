# Story 4.2: Integrate Bolagsverket API for Company Data

## Status

Draft

## Story

**As a** system,
**I want** to fetch company data from Bolagsverket based on org-number,
**so that** I can personalize the law list without manual input.

## Acceptance Criteria

1. API endpoint created: `POST /api/onboarding/fetch-company`
2. Request body: `{ orgNumber: string }`
3. Integration with Bolagsverket API (or alternative Swedish company registry)
4. Fetch: company name, address, SNI code, legal form (AB, HB, etc.), employee count (if available)
5. Response format: `{ name, address, sniCode, legalForm, employeeCount }`
6. Error handling: Invalid org-number, company not found, API timeout
7. Fallback: If Bolagsverket API unavailable, prompt user to enter industry manually
8. Rate limiting: Max 100 requests/hour per IP
9. Logging: Successful fetches, errors to Sentry
10. Test with 10 real org-numbers (verify data accuracy)

## Tasks / Subtasks

- [ ] Research Bolagsverket API access
- [ ] Create API integration
- [ ] Implement error handling
- [ ] Add rate limiting
- [ ] Test with real data

## Dev Notes

**Bolagsverket API:** Public company registry for Sweden
**Alternative:** allabolag.se API, Bisnode, or manual SNI entry fallback

**API Implementation:**

```typescript
export async function POST(request: Request) {
  const { orgNumber } = await request.json()

  try {
    const response = await fetch(
      `https://api.bolagsverket.se/company/${orgNumber}`
    )

    const data = await response.json()

    return NextResponse.json({
      name: data.name,
      address: data.address,
      sniCode: data.sni,
      legalForm: data.companyForm,
      employeeCount: data.employees,
    })
  } catch (error) {
    // Fallback to manual entry
    return NextResponse.json({ error: 'Company not found' }, { status: 404 })
  }
}
```

**Reference:** External APIs documentation, PRD Epic 4

## Change Log

| Date       | Version | Description            | Author     |
| ---------- | ------- | ---------------------- | ---------- |
| 2025-11-11 | 1.0     | Initial story creation | Sarah (PO) |

## Dev Agent Record

_To be populated by dev agent_

## QA Results

_To be populated by QA agent_
