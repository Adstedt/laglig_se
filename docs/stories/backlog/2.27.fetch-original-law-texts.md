# 2.27 Fetch Original Law Texts for Historical Version Reconstruction

## Overview

Currently, historical version comparisons show "text saknas" (text missing) for many sections because we only have amendment text, not the original law text or intermediate versions. This story addresses fetching and storing original law texts to enable complete historical reconstruction.

## Problem Statement

When comparing law versions across time:

- We have amendment documents (SFS changes) with section-level text
- Many older amendments (e.g., SFS 2000:764) are "word replacement" amendments that don't contain full section text
- Without the original law text as a baseline, we cannot reconstruct what sections looked like before these amendments
- Result: ~60% of historical diffs show "text saknas"

### Example: Arbetsmiljölag (1977:1160)

```
4 kap. 3 § amendment history:
┌──────────────────────────────────────────────────────────────┐
│ 1977 (Original)  →  2001 (SFS 2000:764)  →  2014 (SFS 2013:610) │
│     ???          →   "word replacement"   →   Full text (802 ch) │
│  NO TEXT            NO TEXT                   HAS TEXT           │
└──────────────────────────────────────────────────────────────┘
```

## Proposed Solution

### Phase 1: Fetch Original Law PDFs

**Data Sources:**

- `rkrattsdb.gov.se` - Government legal database with PDFs back to 1998
- `svenskforfattningssamling.se` - Full PDFs of new laws

**Implementation:**

1. Create crawler for original law PDFs (similar to amendment crawler)
2. Parse PDF to extract section-by-section text
3. Store as "version 0" / baseline in database
4. Link to LegalDocument as `original_text` or separate table

### Phase 2: Word Replacement Parser

For amendments that only contain word replacements (e.g., "replace 'yrkesinspektionen' with 'Arbetsmiljöverket'"):

1. Parse amendment text to extract replacement patterns
2. Store as structured data: `{ find: "X", replace: "Y", scope: "all" | "section" }`
3. Apply replacements to previous version to reconstruct intermediate versions

### Phase 3: Version Reconstruction Engine

1. Start with original law text (Phase 1)
2. Apply amendments chronologically:
   - Full text amendments: Replace section text
   - Word replacements: Apply find/replace (Phase 2)
   - Structural changes: Handle section additions/removals
3. Cache reconstructed versions for performance

## Database Schema Changes

```prisma
model LawVersion {
  id                String   @id @default(cuid())
  legal_document_id String
  legal_document    LegalDocument @relation(fields: [legal_document_id], references: [id])

  effective_date    DateTime
  source_type       VersionSourceType // ORIGINAL, AMENDMENT, RECONSTRUCTED
  source_sfs        String?  // SFS number if from amendment

  created_at        DateTime @default(now())
}

model LawVersionSection {
  id              String     @id @default(cuid())
  law_version_id  String
  law_version     LawVersion @relation(fields: [law_version_id], references: [id])

  chapter         String?
  section         String
  text_content    String

  @@unique([law_version_id, chapter, section])
}

enum VersionSourceType {
  ORIGINAL      // From original law PDF
  AMENDMENT     // From amendment document
  RECONSTRUCTED // Built by applying word replacements
}
```

## Acceptance Criteria

- [ ] Original law PDFs fetched for laws with amendment history
- [ ] PDF text extracted and stored per-section
- [ ] Word replacement amendments parsed and stored
- [ ] Version reconstruction produces accurate historical text
- [ ] Historical diffs show actual content instead of "text saknas"
- [ ] Performance: Reconstructed versions cached appropriately

## Effort Estimate

- Phase 1 (Original PDFs): 3-5 days
- Phase 2 (Word Replacements): 3-5 days
- Phase 3 (Reconstruction): 2-3 days
- Testing & Validation: 2-3 days

**Total: ~2 weeks**

## Dependencies

- PDF parsing infrastructure (already exists for amendments)
- Access to rkrattsdb.gov.se and svenskforfattningssamling.se

## Priority

**Post-MVP** - Current version-by-version UI is functional and shows available data honestly. This enhancement improves coverage but isn't blocking.

## Related Stories

- 2.13 Amendment Documents & Historical Versions (completed)
- 2.2 Ingest SFS Laws from Riksdagen (completed)
