# Story 2.16: Admin Backoffice for Job Monitoring

## Status

Backlog

## Story

**As a** system administrator,
**I want** an internal dashboard to monitor sync jobs and change detection,
**so that** I can ensure data freshness and quickly identify/resolve issues.

## Background

This story was extracted from Story 2.11 during validation review. While sync jobs and change detection (2.11) are essential for data freshness, the admin UI for monitoring is a separate concern that can be implemented after core sync functionality is working.

## Scope Note

This is **internal infrastructure tooling**, not user-facing UI. Protected via `ADMIN_SECRET` env var, not user authentication.

## Acceptance Criteria

1. Admin route created at `/admin` protected via `ADMIN_SECRET` header check
2. Dashboard displays last sync run time and duration per job type (SFS, Court Cases)
3. Dashboard shows counts: new items, updates, failures for recent syncs
4. Dashboard shows pending AI summaries in queue
5. Recent change events list displayed (last 20)
6. Manual job triggers available for debugging/recovery:
   - "Run SFS Sync Now" button
   - "Run Court Sync Now" button
   - "Reprocess Failed" button
7. Simple job history log showing last 50 runs
8. Health indicators displayed: API reachability, DB connection, queue size
9. Mobile-responsive layout

## Tasks / Subtasks

- [ ] **Task 1: Admin Route Protection**
  - [ ] Create `/app/admin/page.tsx`
  - [ ] Implement `ADMIN_SECRET` header validation middleware
  - [ ] Return 401 if secret not provided/incorrect
  - [ ] Add `ADMIN_SECRET` to environment variables

- [ ] **Task 2: Job Status Dashboard**
  - [ ] Create `SyncStatusCard` component showing last run info
  - [ ] Query `change_events` table for recent activity
  - [ ] Display metrics: new, updated, failed counts
  - [ ] Show time since last successful sync

- [ ] **Task 3: Manual Job Triggers**
  - [ ] Create `/api/admin/trigger-sync` endpoint
  - [ ] Implement SFS sync trigger
  - [ ] Implement Court Case sync trigger
  - [ ] Add loading states and confirmation modals
  - [ ] Log manual trigger events

- [ ] **Task 4: Health Checks**
  - [ ] Create health check utilities in `lib/admin/health.ts`
  - [ ] Check Riksdagen API reachability
  - [ ] Check Domstolsverket API reachability
  - [ ] Check database connection
  - [ ] Display status indicators (green/yellow/red)

- [ ] **Task 5: Job History Log**
  - [ ] Create `SyncJobLog` model if not exists, or use existing logging
  - [ ] Display last 50 job runs in table format
  - [ ] Show: job type, start time, duration, result, error count

## Dev Notes

### Relevant Source Tree

```
app/
└── admin/
    ├── page.tsx              # Main dashboard
    └── components/
        ├── sync-status-card.tsx
        ├── job-history-table.tsx
        └── health-indicators.tsx

lib/
└── admin/
    ├── health.ts             # Health check utilities
    └── triggers.ts           # Manual job trigger functions
```

### Dependencies

- **Blocked by:** Story 2.11 (Change Detection) - Need sync jobs running first
- **Related:** Epic 8 (Change Monitoring) - Admin tooling supports monitoring ops

## Change Log

| Date       | Version | Description                                      | Author     |
| ---------- | ------- | ------------------------------------------------ | ---------- |
| 2025-12-09 | 1.0     | Extracted from Story 2.11 during validation      | Sarah (PO) |
