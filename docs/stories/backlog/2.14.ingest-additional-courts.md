# Story 2.14: Ingest Additional Court Cases (MMOD, MIOD, PMOD, Kammarrätt)

## Status

Draft

## Story

**As a** developer,
**I want** to ingest court cases from additional courts not covered in Story 2.3,
**so that** we have comprehensive coverage of Swedish case law including environmental, migration, and patent courts.

## Background

Story 2.3 ingested 12,060 cases from 4 priority courts (AD, HD, HFD, HovR). The Domstolsverket API contains ~1,800 additional cases from specialty courts that were out of scope.

### Current State (as of 2025-12-09)

| Court | Code | Cases in API | In DB | Gap |
|-------|------|--------------|-------|-----|
| Mark- och miljööverdomstolen | MMOD | 979 | 0 | 979 |
| Migrationsöverdomstolen | MIOD | 522 | 0 | 522 |
| Patent- och marknadsöverdomstolen | PMOD | 215 | 0 | 215 |
| Kammarrätten Stockholm | KST | 75 | 0 | 75 |
| Kammarrätten Göteborg | KGG | 8 | 0 | 8 |
| **Total** | | **1,799** | **0** | **1,799** |

### Business Value

- **MMOD (979 cases):** Environmental/land use law - relevant for construction, real estate, environmental compliance
- **MIOD (522 cases):** Migration law - relevant for employers with foreign workers, immigration consultants
- **PMOD (215 cases):** Patent and market law - relevant for IP, competition, advertising disputes
- **Kammarrätt (83 cases):** Administrative appeals - tax, social welfare, licensing decisions

## Acceptance Criteria

1. New ContentType enum values added for each court type
2. Court case ingestion script extended to support additional courts
3. All ~1,800 cases ingested with full metadata
4. Cross-references to SFS laws extracted (CASE_CITES_LAW)
5. HTML content preserved in `html_content` field
6. Progress logging with ETA per court
7. Error handling continues on individual failures
8. Verification: Database counts match API counts (±1%)

## Tasks / Subtasks

- [ ] **Task 1: Add ContentType Enum Values**
  - [ ] Add `COURT_CASE_MMOD` (Mark- och miljööverdomstolen)
  - [ ] Add `COURT_CASE_MIOD` (Migrationsöverdomstolen)
  - [ ] Add `COURT_CASE_PMOD` (Patent- och marknadsöverdomstolen)
  - [ ] Add `COURT_CASE_KR` (Kammarrätt - combined)
  - [ ] Run migration: `pnpm prisma migrate dev --name add-additional-court-types`

- [ ] **Task 2: Extend Ingestion Script**
  - [ ] Add new courts to `ingest-court-cases.ts`
  - [ ] Map court codes to ContentType:
    - `MMOD` → `COURT_CASE_MMOD`
    - `MIOD` → `COURT_CASE_MIOD`
    - `PMOD` → `COURT_CASE_PMOD`
    - `KST`, `KGG` → `COURT_CASE_KR`
  - [ ] Add CLI flag to run specific courts: `--courts=MMOD,MIOD`

- [ ] **Task 3: Run Ingestion**
  - [ ] Ingest MMOD cases (~979)
  - [ ] Ingest MIOD cases (~522)
  - [ ] Ingest PMOD cases (~215)
  - [ ] Ingest Kammarrätt cases (~83)
  - [ ] Log final statistics

- [ ] **Task 4: Verify & Test**
  - [ ] Run `verify-court-cases.ts` to confirm counts
  - [ ] Sample 5 cases per court to verify content quality
  - [ ] Verify cross-references created
  - [ ] Update integration tests for new court types

## Dev Notes

### Existing Infrastructure

All infrastructure from Story 2.3 can be reused:
- `lib/external/domstolsverket.ts` - API client (no changes needed)
- `scripts/ingest-court-cases.ts` - Just add new court codes
- `scripts/count-all-courts.ts` - Already queries all courts
- `scripts/verify-court-cases.ts` - Will show new counts automatically

### Court Code Mapping

From `count-all-courts.ts`:
```typescript
const additionalCourts = [
  { code: ['MMOD'], name: 'Mark- och miljööverdomstolen', contentType: 'COURT_CASE_MMOD' },
  { code: ['MIOD'], name: 'Migrationsöverdomstolen', contentType: 'COURT_CASE_MIOD' },
  { code: ['PMOD'], name: 'Patent- och marknadsöverdomstolen', contentType: 'COURT_CASE_PMOD' },
  { code: ['KST', 'KGG'], name: 'Kammarrätten', contentType: 'COURT_CASE_KR' },
]
```

### Estimated Runtime

- 1,799 cases at 5 req/sec = ~6 minutes API fetch
- Parse + insert: ~30 minutes
- **Total: ~45 minutes**

## Dependencies

- **Blocked by:** Story 2.3 (Court Case Ingestion) - COMPLETE
- **Related:** Story 2.11 (Change Tracking) - Will track new rulings for these courts too

## Change Log

| Date       | Version | Description            | Author     |
| ---------- | ------- | ---------------------- | ---------- |
| 2025-12-09 | 1.0     | Initial story creation | Bob (SM)   |

## Dev Agent Record

_To be populated by dev agent_

## QA Results

_To be populated by QA agent_
