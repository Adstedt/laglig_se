# Story 2.12: Implement PENDING Status for Laws Not Yet in Force

## Story

**As a** user viewing legal documents,
**I want** to clearly see when a law hasn't entered into force yet,
**So that** I understand that the law's provisions are not currently applicable.

## Status

BACKLOG

## Context

Currently, all laws are ingested with `ACTIVE` status regardless of their effective date. Laws like "Subventionsbrottslag (2025:1267)" which don't enter into force until 2026-01-01 are incorrectly shown as "Gällande" (active).

### Current State
- Status is set to `ACTIVE` at ingestion time
- `REPEALED` status is determined by parsing HTML for "Upphävd" patterns
- Effective dates exist in HTML as `/Träder i kraft I:YYYY-MM-DD/` but aren't used for status
- No API field for status - we derive it ourselves

### Desired State
- New `PENDING` status in `DocumentStatus` enum
- Laws with future effective dates get `PENDING` status
- UI shows "Kommande" badge instead of "Gällande"
- Automated job to transition `PENDING` → `ACTIVE` when effective date passes

## Estimation

**Story Points**: 2

## Acceptance Criteria

### AC1: Database Schema Update
- [ ] Add `PENDING` to `DocumentStatus` enum in Prisma schema
- [ ] Run migration successfully

### AC2: Ingestion Logic Update
- [ ] Update `ingest-sfs-laws.ts` to detect effective date from HTML
- [ ] Set status to `PENDING` if effective date is in the future
- [ ] Set status to `ACTIVE` if effective date is today or past

### AC3: Backfill Existing Data
- [ ] Create script to update existing laws with future effective dates to `PENDING`
- [ ] Verify Subventionsbrottslag (2025:1267) gets `PENDING` status

### AC4: UI Status Badge
- [ ] Update `StatusBadge` component to handle `PENDING` status
- [ ] Display "Kommande" with orange styling for `PENDING` laws
- [ ] Existing "Gällande" (green) and "Upphävd" (red) unchanged

### AC5: Automated Status Transition
- [ ] Create script/cron job to check `PENDING` laws daily
- [ ] Transition to `ACTIVE` when `effective_date <= today`
- [ ] Log transitions for audit trail

### AC6: Search Integration
- [ ] Add filter option "Kommande lagar" in search
- [ ] Default search shows all statuses (or configurable)

## Technical Notes

### Prisma Schema Change
```prisma
enum DocumentStatus {
  ACTIVE
  PENDING    // NEW - law not yet in force
  REPEALED
  DRAFT
  ARCHIVED
}
```

### Effective Date Detection
Pattern in HTML: `/Träder i kraft I:(\d{4})-(\d{2})-(\d{2})/`
- Found in header section (before first `<a class="paragraf">`)
- Already implemented in `extractLawMetadata()` in law page

### Status Transition Job
Options:
1. Vercel Cron Job (free tier: once/day)
2. GitHub Actions scheduled workflow
3. Supabase pg_cron extension

## Dependencies

- Story 2.2: SFS law ingestion (complete)
- Story 2.5: SEO pages (complete)

## Change Log

| Date       | Version | Description            | Author     |
| ---------- | ------- | ---------------------- | ---------- |
| 2025-12-09 | 1.0     | Initial backlog story  | Dev Agent  |
