# Story 2.5: Generate SEO-Optimized Pages for All Content Types

## Status

Draft

## Story

**As a** visitor,
**I want** to view any legal document (law, court case, EU regulation) on a public, SEO-optimized page,
**so that** I can discover Laglig.se through Google search.

## Acceptance Criteria

1. Dynamic routes created for each content type:
   - `/lagar/[lawSlug]` for SFS laws
   - `/rattsfall/hd/[caseSlug]` for HD cases
   - `/rattsfall/hovr/[caseSlug]` for HovR cases
   - `/rattsfall/hfd/[caseSlug]` for HFD cases
   - `/eu/forordningar/[regSlug]` for EU regulations
   - `/eu/direktiv/[dirSlug]` for EU directives
2. All pages use Server-Side Rendering (SSR) for SEO
3. URL slugs generated from titles + document numbers
4. Each page displays type-appropriate content:
   - SFS: Law title, SFS number, full text, effective date, amendments list
   - Court cases: Case number, court, decision date, summary, full judgment, cited laws
   - EU: Document number, CELEX, title, full text, national implementation measures (directives)
5. Meta tags optimized per content type (title, description, Open Graph)
6. Structured data (JSON-LD) for legal documents and court cases
7. Sitemap.xml auto-generated listing ALL 170,000+ pages (split into multiple sitemaps if needed)
8. Canonical URLs set for all content types
9. Core Web Vitals meet targets: LCP <2.5s, CLS <0.1, FID <100ms
10. Mobile-responsive layout for all content types
11. Legal disclaimer in footer: "AI-assisted guidance, not legal advice"

## Tasks / Subtasks

- [ ] Create law page route (AC: 1, 2, 3, 4)
  - [ ] Create `app/lagar/[lawSlug]/page.tsx`
  - [ ] Implement generateStaticParams for static generation
  - [ ] Fetch law data with Prisma including amendments
  - [ ] Display law content with proper formatting
  - [ ] Add breadcrumbs: Home → Lagar → [Law name]

- [ ] Create court case routes (AC: 1, 2, 3, 4)
  - [ ] Create `app/rattsfall/hd/[caseSlug]/page.tsx`
  - [ ] Create `app/rattsfall/hovr/[caseSlug]/page.tsx`
  - [ ] Create `app/rattsfall/hfd/[caseSlug]/page.tsx`
  - [ ] Include cited laws section with links
  - [ ] Display parties, decision date, court name

- [ ] Create EU legislation routes (AC: 1, 2, 3, 4)
  - [ ] Create `app/eu/forordningar/[regSlug]/page.tsx`
  - [ ] Create `app/eu/direktiv/[dirSlug]/page.tsx`
  - [ ] Display CELEX number, EUT reference
  - [ ] For directives: show Swedish implementing laws

- [ ] Implement SEO meta tags (AC: 5)
  - [ ] Create generateMetadata function for each route
  - [ ] Title format: "[Doc name] - [Number] | Laglig.se"
  - [ ] Description: First 155 chars of content
  - [ ] Open Graph tags for social sharing
  - [ ] Twitter Card tags

- [ ] Add JSON-LD structured data (AC: 6)
  - [ ] LegalDocument schema for laws
  - [ ] CourtCase schema for court cases
  - [ ] Legislation schema for EU documents
  - [ ] Include datePublished, author (government), inLanguage

- [ ] Generate comprehensive sitemap (AC: 7)
  - [ ] Create `app/sitemap.ts`
  - [ ] Query all documents from database
  - [ ] Split into multiple sitemap files if >50,000 URLs
  - [ ] Format: sitemap-0.xml, sitemap-1.xml, sitemap-2.xml, sitemap-3.xml
  - [ ] Priority: 0.7 for law pages, 0.6 for cases, 0.5 for EU
  - [ ] Update frequency: weekly for all

- [ ] Set canonical URLs (AC: 8)
  - [ ] Add canonical link tag to each page type
  - [ ] Format: https://laglig.se/lagar/arbetsmiljolagen-1977-1160

- [ ] Optimize Core Web Vitals (AC: 9)
  - [ ] Test LCP: Optimize hero image, use next/image
  - [ ] Test FID: Minimize JavaScript, use Server Components
  - [ ] Test CLS: Reserve space for dynamic content, use aspect ratios
  - [ ] Run Lighthouse on sample pages
  - [ ] Ensure all scores >90

- [ ] Implement responsive design (AC: 10)
  - [ ] Test mobile (375px width)
  - [ ] Test tablet (768px width)
  - [ ] Test desktop (1920px width)
  - [ ] Ensure text readable, no horizontal scroll

- [ ] Add legal disclaimer (AC: 11)
  - [ ] Update footer component
  - [ ] Text: "Laglig.se provides AI-assisted legal information. This is not legal advice. Consult a qualified lawyer for specific guidance."
  - [ ] Link to full disclaimer page

## Dev Notes

### Law Page Implementation

**app/lagar/[lawSlug]/page.tsx:**

```typescript
import { prisma } from '@/lib/prisma'
import { notFound } from 'next/navigation'
import { Metadata } from 'next'

interface Props {
  params: { lawSlug: string }
}

export async function generateStaticParams() {
  const laws = await prisma.legalDocument.findMany({
    where: { contentType: 'SFS_LAW' },
    select: { slug: true },
  })

  return laws.map((law) => ({
    lawSlug: law.slug,
  }))
}

export async function generateMetadata({ params }: Props): Promise<Metadata> {
  const law = await prisma.legalDocument.findUnique({
    where: { slug: params.lawSlug },
  })

  if (!law) return {}

  const description = law.summary
    ? law.summary.substring(0, 155)
    : `Läs ${law.title} i sin helhet på Laglig.se`

  return {
    title: `${law.title} - ${law.documentNumber} | Laglig.se`,
    description,
    openGraph: {
      title: law.title,
      description,
      type: 'article',
      publishedTime: law.publicationDate?.toISOString(),
    },
    alternates: {
      canonical: `https://laglig.se/lagar/${law.slug}`,
    },
  }
}

export default async function LawPage({ params }: Props) {
  const law = await prisma.legalDocument.findUnique({
    where: { slug: params.lawSlug },
    include: {
      amendments: {
        include: {
          amendingDocument: true,
        },
        orderBy: { effectiveDate: 'desc' },
      },
      subjectTags: true,
    },
  })

  if (!law) notFound()

  const jsonLd = {
    '@context': 'https://schema.org',
    '@type': 'LegalDocument',
    name: law.title,
    identifier: law.documentNumber,
    datePublished: law.publicationDate?.toISOString(),
    inLanguage: 'sv',
    publisher: {
      '@type': 'Organization',
      name: 'Riksdagen',
    },
  }

  return (
    <>
      <script
        type="application/ld+json"
        dangerouslySetInnerHTML={{ __html: JSON.stringify(jsonLd) }}
      />

      <div className="max-w-4xl mx-auto p-6">
        {/* Breadcrumbs */}
        <nav className="text-sm mb-4">
          <a href="/" className="text-primary hover:underline">Hem</a>
          {' → '}
          <a href="/lagar" className="text-primary hover:underline">Lagar</a>
          {' → '}
          <span>{law.title}</span>
        </nav>

        {/* Law Header */}
        <h1 className="text-4xl font-bold mb-2">{law.title}</h1>
        <p className="text-gray-600 text-lg mb-2">{law.documentNumber}</p>

        {law.effectiveDate && (
          <p className="text-sm text-gray-500 mb-4">
            Ikraftträdande: {law.effectiveDate.toLocaleDateString('sv-SE')}
          </p>
        )}

        {/* Category Tags */}
        <div className="flex gap-2 mb-6">
          {law.subjectTags?.map((tag) => (
            <span
              key={tag.id}
              className="bg-gray-100 px-3 py-1 rounded-full text-sm"
            >
              {tag.subjectName}
            </span>
          ))}
        </div>

        {/* Law Content */}
        <div className="prose max-w-none mb-12">
          <div dangerouslySetInnerHTML={{ __html: law.fullText }} />
        </div>

        {/* Amendments Section */}
        {law.amendments.length > 0 && (
          <section className="mb-12">
            <h2 className="text-2xl font-bold mb-4">Ändringar</h2>
            <div className="space-y-4">
              {law.amendments.map((amendment) => (
                <div key={amendment.id} className="border-l-4 border-primary pl-4">
                  <h3 className="font-semibold">
                    <a
                      href={`/lagar/${amendment.amendingDocument.slug}`}
                      className="text-primary hover:underline"
                    >
                      {amendment.amendingLawTitle}
                    </a>
                  </h3>
                  <p className="text-sm text-gray-600 mb-2">
                    Ikraftträdande: {amendment.effectiveDate?.toLocaleDateString('sv-SE')}
                  </p>
                  {amendment.summary && (
                    <p className="text-gray-700">{amendment.summary}</p>
                  )}
                  {amendment.affectedSectionsRaw && (
                    <p className="text-sm text-gray-500 mt-2">
                      Berörda paragrafer: {amendment.affectedSectionsRaw}
                    </p>
                  )}
                </div>
              ))}
            </div>
          </section>
        )}

        {/* Footer Disclaimer */}
        <div className="border-t pt-6 mt-12 text-sm text-gray-600">
          <p>
            ⚠️ Denna information är AI-assisterad och utgör inte juridisk rådgivning.
            Kontakta en kvalificerad jurist för specifik vägledning.
          </p>
        </div>
      </div>
    </>
  )
}
```

### Court Case Page Implementation

**app/rattsfall/hd/[caseSlug]/page.tsx:**

```typescript
export default async function CourtCasePage({ params }: Props) {
  const courtCase = await prisma.legalDocument.findUnique({
    where: { slug: params.caseSlug },
    include: {
      courtCaseMetadata: true,
      citedLaws: {
        include: {
          targetDocument: true,
        },
      },
    },
  })

  if (!courtCase) notFound()

  return (
    <div className="max-w-4xl mx-auto p-6">
      <h1 className="text-4xl font-bold mb-2">
        {courtCase.courtCaseMetadata?.courtName} {courtCase.documentNumber}
      </h1>

      <div className="grid grid-cols-2 gap-4 mb-6 text-sm">
        <div>
          <span className="font-semibold">Domstol:</span>{' '}
          {courtCase.courtCaseMetadata?.courtName}
        </div>
        <div>
          <span className="font-semibold">Avgörandedatum:</span>{' '}
          {courtCase.publicationDate?.toLocaleDateString('sv-SE')}
        </div>
      </div>

      {courtCase.summary && (
        <div className="bg-blue-50 p-4 rounded-lg mb-6">
          <h2 className="font-semibold mb-2">Sammanfattning</h2>
          <p>{courtCase.summary}</p>
        </div>
      )}

      <div className="prose max-w-none mb-12">
        <div dangerouslySetInnerHTML={{ __html: courtCase.fullText }} />
      </div>

      {courtCase.citedLaws.length > 0 && (
        <section>
          <h2 className="text-2xl font-bold mb-4">Citerade lagar</h2>
          <ul className="space-y-2">
            {courtCase.citedLaws.map((ref) => (
              <li key={ref.id}>
                <a
                  href={`/lagar/${ref.targetDocument.slug}`}
                  className="text-primary hover:underline"
                >
                  {ref.targetDocument.title} ({ref.targetDocument.documentNumber})
                </a>
                {ref.context && (
                  <p className="text-sm text-gray-600 ml-4">{ref.context}</p>
                )}
              </li>
            ))}
          </ul>
        </section>
      )}
    </div>
  )
}
```

### Sitemap Generation

**app/sitemap.ts:**

```typescript
import { prisma } from '@/lib/prisma'
import { MetadataRoute } from 'next'

export default async function sitemap(): Promise<MetadataRoute.Sitemap> {
  const baseUrl = 'https://laglig.se'

  // Fetch all legal documents
  const documents = await prisma.legalDocument.findMany({
    select: {
      slug: true,
      contentType: true,
      updatedAt: true,
    },
  })

  // Map to sitemap entries with type-specific URLs
  const entries = documents.map((doc) => {
    let url = baseUrl

    switch (doc.contentType) {
      case 'SFS_LAW':
        url += `/lagar/${doc.slug}`
        break
      case 'HD_SUPREME_COURT':
        url += `/rattsfall/hd/${doc.slug}`
        break
      case 'HOVR_COURT_APPEAL':
        url += `/rattsfall/hovr/${doc.slug}`
        break
      case 'HFD_ADMIN_SUPREME':
        url += `/rattsfall/hfd/${doc.slug}`
        break
      case 'EU_REGULATION':
        url += `/eu/forordningar/${doc.slug}`
        break
      case 'EU_DIRECTIVE':
        url += `/eu/direktiv/${doc.slug}`
        break
    }

    return {
      url,
      lastModified: doc.updatedAt,
      changeFrequency: 'weekly' as const,
      priority: doc.contentType === 'SFS_LAW' ? 0.7 : 0.6,
    }
  })

  return entries
}
```

**Note:** If entries exceed 50,000, implement sitemap index:

- Create `app/sitemap-[index].xml.ts` dynamic routes
- Generate `app/sitemap-index.xml` listing all sub-sitemaps

### Core Web Vitals Optimization

**LCP (Largest Contentful Paint) <2.5s:**

- Use Server Components (no client-side JS)
- Optimize images with next/image
- Use font-display: swap for custom fonts
- Minimize render-blocking resources

**FID (First Input Delay) <100ms:**

- Minimal JavaScript on law pages
- No heavy client-side frameworks
- Use native browser features

**CLS (Cumulative Layout Shift) <0.1:**

- Set explicit width/height on images
- Reserve space for dynamic content
- Use CSS aspect-ratio for media

**Testing:**

```bash
# Run Lighthouse
npx lighthouse https://laglig.se/lagar/arbetsmiljolagen-1977-1160 --only-categories=performance,seo,accessibility --view

# Test multiple pages
for page in arbetsmiljolagen-1977-1160 gdpr-dataskyddsforordningen anstallningsskyddslagen-1982-80; do
  npx lighthouse https://laglig.se/lagar/$page --only-categories=performance --quiet
done
```

### Important Architecture References

**From Section 10.4 (Routing Architecture):**

- Dynamic routes with generateStaticParams
- Static generation at build time
- Caching strategies

**From Section 2.2 (SEO Strategy):**

- SSR for all public pages
- Meta tags configuration
- Structured data implementation

**From Front-End Spec Section 4 (Wireframes):**

- Law page layout design
- Court case page structure
- Responsive breakpoints

### Testing

**Test File:** `tests/e2e/pages/law-pages.spec.ts`

```typescript
import { test, expect } from '@playwright/test'

test.describe('Law Pages', () => {
  test('law page renders with SSR', async ({ page }) => {
    await page.goto('/lagar/arbetsmiljolagen-1977-1160')

    // Check content loaded
    await expect(page.locator('h1')).toContainText('Arbetsmiljölagen')
    await expect(page.locator('body')).toContainText('SFS 1977:1160')

    // Check meta tags
    const title = await page.title()
    expect(title).toContain('Arbetsmiljölagen')

    // Check structured data
    const jsonLd = await page
      .locator('script[type="application/ld+json"]')
      .textContent()
    expect(jsonLd).toContain('LegalDocument')
  })

  test('amendments section displays correctly', async ({ page }) => {
    await page.goto('/lagar/arbetsmiljolagen-1977-1160')

    // Check amendments section exists
    await expect(page.getByRole('heading', { name: 'Ändringar' })).toBeVisible()

    // Check amendment links work
    const firstAmendment = page.locator('a[href*="/lagar/"]').first()
    await expect(firstAmendment).toBeVisible()
  })

  test('mobile responsive', async ({ page }) => {
    await page.setViewportSize({ width: 375, height: 667 })
    await page.goto('/lagar/arbetsmiljolagen-1977-1160')

    // Check no horizontal scroll
    const scrollWidth = await page.evaluate(
      () => document.documentElement.scrollWidth
    )
    const clientWidth = await page.evaluate(
      () => document.documentElement.clientWidth
    )
    expect(scrollWidth).toBe(clientWidth)
  })
})

test.describe('Court Case Pages', () => {
  test('court case page renders correctly', async ({ page }) => {
    await page.goto('/rattsfall/hd/nja-2023-10')

    await expect(page.locator('h1')).toContainText('Högsta domstolen')
    await expect(
      page.getByRole('heading', { name: 'Citerade lagar' })
    ).toBeVisible()
  })
})

test.describe('Sitemap', () => {
  test('sitemap.xml accessible and valid', async ({ request }) => {
    const response = await request.get('/sitemap.xml')
    expect(response.status()).toBe(200)

    const text = await response.text()
    expect(text).toContain('<?xml version="1.0"')
    expect(text).toContain('<urlset')
    expect(text).toContain('/lagar/')
    expect(text).toContain('/rattsfall/')
  })
})
```

**Performance Test:**

```typescript
test('Core Web Vitals meet targets', async ({ page }) => {
  await page.goto('/lagar/arbetsmiljolagen-1977-1160')

  const metrics = await page.evaluate(() =>
    JSON.parse(JSON.stringify(performance.getEntriesByType('navigation')[0]))
  )

  // LCP should be < 2500ms
  const lcp = await page.evaluate(() => {
    return new Promise((resolve) => {
      new PerformanceObserver((list) => {
        const entries = list.getEntries()
        resolve(entries[entries.length - 1].renderTime)
      }).observe({ type: 'largest-contentful-paint', buffered: true })
    })
  })

  expect(lcp).toBeLessThan(2500)
})
```

### User Responsibilities

- None for this story (all pages are public)

### Developer Responsibilities

- Create all dynamic routes for content types
- Implement SSR with proper meta tags
- Generate comprehensive sitemap
- Optimize for Core Web Vitals
- Test across devices and browsers
- Monitor SEO performance in Google Search Console

## Change Log

| Date       | Version | Description            | Author     |
| ---------- | ------- | ---------------------- | ---------- |
| 2025-11-11 | 1.0     | Initial story creation | Sarah (PO) |

## Dev Agent Record

### Agent Model Used

_To be populated by dev agent_

### Debug Log References

_To be populated by dev agent_

### Completion Notes List

_To be populated by dev agent_

### File List

_To be populated by dev agent_

## QA Results

_To be populated by QA agent_
